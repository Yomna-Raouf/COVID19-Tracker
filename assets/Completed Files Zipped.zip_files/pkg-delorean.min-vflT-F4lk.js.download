define("modules/clean/react/delorean/components/folder_history/folder_history_card",["require","exports","tslib","react","modules/core/user_i18n","modules/clean/avatar/avatar_with_default","modules/clean/avatar/initials_avatar","classnames","modules/core/format_html"],(function(e,t,a,n,r,s,o,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),r=a.__importStar(r),s=a.__importDefault(s),i=a.__importDefault(i),t.CardAvatar=function(e){var t=e.actor,a=e.toBeRolledBack;if(!t)return null;var d=t.photo_url?t.photo_url:void 0,l=i.default({"folder-history-event-card__avatar":!0,"folder-history-event-card__avatar--to-be-rolled-back":a});return n.default.createElement("div",{className:"folder-history-event-card__avatar-container"},n.default.createElement(s.default,{optionalClass:l,dimension:24,shape:"CIRCLE",photoUrl:d,defaultAvatar:n.default.createElement(o.InitialsAvatarWithColorDerivedFromName,{optionalClass:l,dimension:24,shape:"CIRCLE",initials:r.getInitials(t.display_name),name:t.display_name})}))},t.CardCircle=function(e){var t=e.hovered;return n.default.createElement("div",{className:i.default({"folder-history-event-card__circle":!0,"folder-history-event-card__circle--hovered":t})})},t.CardDividerLine=function(e){var t=e.style;return n.default.createElement("div",{className:"folder-history-event-card__line-container"},n.default.createElement("div",{className:i.default({"folder-history-event-card__line":!0,"folder-history-event-card__line--pulse":"pulsing"===t,"folder-history-event-card__line--normal":"default"===t,"folder-history-event-card__line--hovered":"dashed"===t,"folder-history-event-card__line--selected":"solid"===t,"folder-history-event-card__line--invisible":"none"===t})}),e.text&&n.default.createElement("div",{className:"folder-history-event-card__line__text"},e.text))};var l=function(e){return n.default.createElement("div",{className:"folder-history-event-card__card-heading"},d.legacyFormatHtmlAsReact(e.event.eventHeadline,{strong:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.default.createElement("strong",null,e)}}))},p=function(e){return n.default.createElement("div",{className:"folder-history-event-card__card-subheading"},e.event.timeAgo,e.event.cardSubheading?n.default.createElement("span",null," • ",e.event.cardSubheading):void 0)},c=(function(e){function r(t){var a=e.call(this,t)||this;return a.handleMouseOver=function(e){var t=e.currentTarget.getBoundingClientRect();a.props.onMouseOver(a.props.event,(e.clientY-t.top)/t.height>.5?"bottom":"top")},a.handleMouseOut=function(){a.props.onMouseOut(a.props.event)},a.onClickOnEvent=function(){a.props.onClick(a.props.event)},a}return a.__extends(r,e),r.prototype.render=function(){var e=this.props,r=e.event,s=e.rewindMode,o=e.dividerLineStateTop,d=e.dividerLineStateBottom,c=n.default.createElement("div",{className:i.default({"folder-history-event-card__card-text":!0})},n.default.createElement(l,{event:r}),n.default.createElement(p,{event:r})),u=n.default.createElement("button",{className:i.default({"include-in-rewind":!this.props.willRewindEvent&&s,"event-text-faded":this.props.isFaded&&s,"for-rewind":s}),onClick:this.onClickOnEvent},n.default.createElement("div",{className:"folder-history-event-card__border"},n.default.createElement(t.CardAvatar,{actor:r.actor,toBeRolledBack:this.props.willRewindEvent}),c));return n.default.createElement("div",{onMouseOver:this.handleMouseOver,onMouseLeave:this.handleMouseOut,className:i.default({"folder-history-event-card":!0})},n.default.createElement(t.CardDividerLine,a.__assign({},o)),u,n.default.createElement(t.CardDividerLine,a.__assign({},d)))},r})(n.default.Component);t.FolderHistoryEventCard=c})),define("modules/clean/react/delorean/components/folder_history/folder_history_header",["require","exports","tslib","react"],(function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),t.FolderHistoryEventHeader=function(e){return n.default.createElement("div",{className:"folder-history-event-header"},n.default.createElement("div",null,e.segmentName))}})),define("modules/clean/react/delorean/components/folder_history/folder_history",["require","exports","tslib","react","modules/clean/react/delorean/components/folder_history/folder_history_header","modules/core/i18n","modules/clean/react/delorean/components/folder_history/folder_history_card","modules/clean/react/delorean/util","classnames","modules/clean/react/delorean/data/types","modules/clean/static_urls","modules/clean/react/delorean/components/folder_history/folder_history_skeleton","modules/clean/react/sticky/container","modules/clean/react/sticky/sticky","spectrum/icon_arrow","spectrum/tertiary_link","modules/clean/components/loading_indicator","react-dom","modules/clean/react/delorean/data/reducer_helpers"],(function(e,t,a,n,r,s,o,i,d,l,p,c,u,h,g,f,v,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),d=a.__importDefault(d),m=a.__importDefault(m);var y=function(e){var t=e.cursor,a=e.direction;return n.default.createElement("div",{className:d.default({"folder-history-show-more-card":!0,"folder-history-show-more-card--future":a===l.PaginationDirection.future,"folder-history-show-more-card--past":a===l.PaginationDirection.past})},n.default.createElement(f.TertiaryLink,{onClick:function(){e.onShowMore(t)}},n.default.createElement("div",{className:"folder-history-show-more-card--arrow-container"},n.default.createElement(g.IconArrow,{className:"arrow",name:"right"})),n.default.createElement("div",{className:"folder-history-show-more-card--text"},e.direction===l.PaginationDirection.future?s.intl.formatMessage({id:"kDTfEb",defaultMessage:"Show newer changes"}):s.intl.formatMessage({id:"bsh6R7",defaultMessage:"Show older changes"}))))},w=(function(e){function t(t){var a=e.call(this,t)||this;return a.previousTopOfListRef=null,a.topOfListRef=null,a.selectedDateOnGraphRef=null,a.onMouseOverEvent=function(e,t){if(a.props.events.type===l.RewindEventState.hasContent){var n=a.getProcessedEvents(a.props.events.processedEvents),r=i.findIndex(n,(function(t){return t.type===l.DeloreanEventType.event&&t.uid===e.uid}));if(void 0===r)return;1===r&&"top"===t&&(t="bottom");var s=void 0,o=void 0;if("top"===t){o=n[r];for(var d=r-1;d>=0;d--){if((p=n[d]).type===l.DeloreanEventType.event){s=p;break}}}if("bottom"===t){s=n[r];for(d=r+1;d<n.length;d++){var p;if((p=n[d]).type===l.DeloreanEventType.event){o=p;break}}}s&&o?a.setState({hoveredEvents:{topEvent:s,botEvent:o}}):s&&!o?a.setState({hoveredEvents:{topEvent:s}}):a.setState({hoveredEvents:void 0})}},a.handleClick=function(e){a.props.isForARewind&&a.setState({selectedEvents:a.state.hoveredEvents}),a.state.hoveredEvents&&a.props.onClickEvent(a.state.hoveredEvents)},a.eventRef=function(e){e!==a.topOfListRef&&null!==e&&(a.previousTopOfListRef=a.topOfListRef,a.topOfListRef=m.default.findDOMNode(e))},a.setSelectedDateOnGraphRef=function(e){a.selectedDateOnGraphRef=null!==e?m.default.findDOMNode(e):null},a.setContainerRef=function(e){a.containerRef=e},a.hoverOut=function(){a.setState({hoveredEvents:void 0})},a.state={hoveredEvents:void 0,selectedEvents:void 0},a}return a.__extends(t,e),t.prototype.componentDidUpdate=function(e){if((this.topOfListRef&&!document.body.contains(this.topOfListRef)||this.previousTopOfListRef&&!document.body.contains(this.previousTopOfListRef))&&(this.topOfListRef=null,this.previousTopOfListRef=null,this.selectedDateOnGraphRef=null),this.props.events.type===l.RewindEventState.hasContent&&this.props.pagesLoaded!==e.pagesLoaded&&this.props.pagesLoaded)if(2===this.props.pagesLoaded)this.selectedDateOnGraphRef&&this.selectedDateOnGraphRef.scrollIntoView(!0);else if(this.props.pagesLoaded>2&&this.containerRef&&this.previousTopOfListRef&&this.topOfListRef){var t=this.containerRef,a=this.previousTopOfListRef.offsetTop-this.topOfListRef.offsetTop;t.scrollBy(0,a)}},t.prototype.getProcessedEvents=function(e){if(this.props.selectedDateTsInMs){var t=i.floorDate(new Date(this.props.selectedDateTsInMs));if(!(e.filter((function(e){return e.type===l.DeloreanEventType.dateBanner&&e.date.getTime()===t.getTime()})).length>0)){var n=_.createDateBanner(t),r=_.createEmptyDay(t);if(e[0].date<t)e=this.props.events.type===l.RewindEventState.hasContent&&"reached-end"===this.props.events.cursorFuture.type?a.__spreadArrays([n],e):a.__spreadArrays([n,r],e);else if(e[e.length-1].date>t)e=this.props.events.type===l.RewindEventState.hasContent&&"reached-end"===this.props.events.cursorPast.type?a.__spreadArrays(e,[n]):a.__spreadArrays(e,[n,r]);else for(var s=0;s<e.length-1;s++)if(e[s].date>t&&e[s+1].date<t){e.splice(s+1,0,n,r);break}}}return e},t.prototype.renderNeverLoaded=function(){return null},t.prototype.renderLoading=function(){return n.default.createElement(c.FolderHistoryEventCardsSkeleton,{animated:!0})},t.prototype.renderEvents=function(e){var t,a,r=this;t=e.loadingPastPage?n.default.createElement("div",{className:"folder-history-show-more-card"},n.default.createElement(v.LoadingIndicator,{style:"blue_spinner"})):"reached-end"===e.cursorPast.type?n.default.createElement("div",{className:"folder-history-empty-event-card"},s.intl.formatMessage({id:"WXQmpV",defaultMessage:"That’s as far back as it goes"})):n.default.createElement(y,{cursor:e.cursorPast,direction:l.PaginationDirection.past,onShowMore:this.props.onShowMorePast}),a=e.loadingFuturePage?n.default.createElement("div",{className:"folder-history-show-more-card"},n.default.createElement(v.LoadingIndicator,{style:"blue_spinner"})):"reached-end"===e.cursorFuture.type?n.default.createElement("div",{className:"folder-history-empty-event-card"},s.intl.formatMessage({id:"rA9DJ0",defaultMessage:"No newer activity."})):n.default.createElement(y,{cursor:e.cursorFuture,direction:l.PaginationDirection.future,onShowMore:this.props.onShowMoreFuture});var o=this.getProcessedEvents(e.processedEvents),d=this.state.hoveredEvents?i.findIndex(o,(function(e){return e.type===l.DeloreanEventType.event&&e.uid===r.state.hoveredEvents.topEvent.uid})):void 0,p=this.state.selectedEvents?i.findIndex(o,(function(e){return e.type===l.DeloreanEventType.event&&e.uid===r.state.selectedEvents.topEvent.uid})):void 0,c=o[0],h=o.slice(1);return n.default.createElement(u.StickyContainer,{offsetTop:0},this.renderEvent({event:c,willRewindEvent:!1,isTopmostEvent:!1,isAnythingInListSelectedOrHovered:void 0!==this.state.selectedEvents}),a,h.map((function(e,t){var a=!1;return r.props.isForARewind&&(r.state.selectedEvents&&void 0!==p&&t<p&&(a=!0),!r.state.selectedEvents&&void 0!==d&&t<d&&(a=!0),e.type===l.DeloreanEventType.emptyDay&&(r.state.selectedEvents?e.date<r.state.selectedEvents.topEvent.date&&(!r.state.selectedEvents.botEvent||e.date>r.state.selectedEvents.botEvent.date)&&(a=!0):r.state.hoveredEvents&&e.date<r.state.hoveredEvents.topEvent.date&&(!r.state.hoveredEvents.botEvent.date||e.date>r.state.hoveredEvents.botEvent.date)&&(a=!0)),void 0===d&&void 0===p&&(a=!0)),r.renderEvent({event:e,willRewindEvent:a,isTopmostEvent:0===t,isAnythingInListSelectedOrHovered:!!r.state.selectedEvents||!!r.state.hoveredEvents})})),t)},t.prototype.renderEvent=function(e){var t=e.event,a=e.willRewindEvent,p=e.isTopmostEvent,c=e.isAnythingInListSelectedOrHovered;if(t.type===l.DeloreanEventType.event){var u={top:{style:"none",position:"top",text:""},bottom:{style:"none",position:"bottom",text:""}};if(this.props.isForARewind){var g=s.intl.formatMessage({id:"4EZH1k",defaultMessage:"Choose what to keep"});this.state.hoveredEvents&&this.state.hoveredEvents.botEvent&&this.state.hoveredEvents.botEvent.uid===t.uid&&(u.top={position:"top",style:"dashed",text:g}),this.state.hoveredEvents&&!this.state.hoveredEvents.botEvent&&this.state.hoveredEvents.topEvent.uid===t.uid&&(u.bottom={position:"bottom",style:"dashed",text:g}),this.state.selectedEvents&&this.state.selectedEvents.botEvent&&this.state.selectedEvents.botEvent.uid===t.uid&&(u.top={position:"top",style:"solid",text:this.state.selectedEvents.botEvent.confirmationCardDate}),this.state.selectedEvents&&!this.state.selectedEvents.botEvent&&this.state.selectedEvents.topEvent.uid===t.uid&&(u.bottom={position:"bottom",style:"solid",text:this.state.selectedEvents.topEvent.confirmationCardDate}),c||(u.top={position:"top",style:"pulsing",text:""})}return n.default.createElement(o.FolderHistoryEventCard,{key:t.uid,ref:p?this.eventRef:void 0,rewindMode:this.props.isForARewind,onClick:this.handleClick,onMouseOver:this.onMouseOverEvent,onMouseOut:i.noop,event:t,willRewindEvent:a,isFaded:a&&!!this.state.hoveredEvents,isSelected:!1,dividerLineStateTop:u.top,dividerLineStateBottom:u.bottom})}return t.type===l.DeloreanEventType.dateBanner?n.default.createElement(h.Sticky,{ref:this.props.selectedDateTsInMs&&i.roundDate(t.date)===i.roundDate(new Date(this.props.selectedDateTsInMs))?this.setSelectedDateOnGraphRef:void 0,className:"folder-history-sticky-header"},n.default.createElement(r.FolderHistoryEventHeader,{segmentName:t.eventCardDate})):t.type===l.DeloreanEventType.emptyDay?n.default.createElement("div",{className:d.default({"folder-history-empty-event-card":!0,"folder-history-empty-event-card__include-in-rewind":!a})},s.intl.formatMessage({id:"l0PRXC",defaultMessage:"Nothing happened on this day"})):i.assertNever(t)},t.prototype.renderEmptyList=function(){return this.props.events.type!==l.RewindEventState.hasContent?null:n.default.createElement("div",null,n.default.createElement(r.FolderHistoryEventHeader,{segmentName:s.intl.formatMessage({id:"JDRaFD",defaultMessage:"Today"})}),n.default.createElement("img",{alt:"",className:"folder-history-event-list__empty-img",src:p.static_url("/static/images/delorean/illo-no-activity-vflHN_Psx.png")}),n.default.createElement("div",{className:"folder-history-event-list__empty-text"},s.intl.formatMessage({id:"XxsZeM",defaultMessage:"Sorry, there’s no content here!"})))},t.prototype.render=function(){var e;return this.props.events.type===l.RewindEventState.loadingEntirePanel||this.props.pagesLoaded&&this.props.pagesLoaded<2?e=this.renderLoading():this.props.events.type===l.RewindEventState.hasContent?e=0===this.props.events.processedEvents.length?this.renderEmptyList():this.renderEvents(this.props.events):(i.assertNever(this.props.events),e=null),n.default.createElement("div",{onMouseLeave:this.hoverOut,ref:this.setContainerRef,className:"folder-history-event-list"},e)},t})(n.default.PureComponent);t.FolderHistory=w})),define("modules/clean/react/delorean/components/folder_history/folder_history_skeleton",["require","exports","tslib","react","classnames","modules/clean/react/delorean/constants"],(function(e,t,a,n,r,s){"use strict";var o;Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),r=a.__importDefault(r),(function(e){e[e.Avatar=0]="Avatar",e[e.Heading=1]="Heading",e[e.Subheading=2]="Subheading"})(o||(o={}));var i=function(e){var t=e.type,a=e.animated&&t!==o.Avatar,s=r.default({"folder-history-skeleton__skeleton-card":!0,"folder-history-skeleton__avatar":t===o.Avatar,"folder-history-skeleton__heading":t===o.Heading,"folder-history-skeleton__subheading":t===o.Subheading});return n.default.createElement("div",{className:s},a&&n.default.createElement("div",{className:"folder-history-skeleton__glint"}))},d=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return n.default.createElement("div",{className:"folder-history-event-card folder-history-event-skeleton"},n.default.createElement("div",{className:"folder-history-event-card__border"},n.default.createElement("div",{className:"folder-history-event-card__avatar-container"},n.default.createElement(i,{type:o.Avatar,animated:this.props.animated})),n.default.createElement("div",{className:"folder-history-event-card__card-text"},n.default.createElement("div",{className:"folder-history-event-card__card-heading"},n.default.createElement(i,{type:o.Heading,animated:this.props.animated})),n.default.createElement("div",{className:"folder-history-event-card__card-subheading"},n.default.createElement(i,{type:o.Subheading,animated:this.props.animated})))))},t})(n.default.PureComponent),l=(function(e){function t(t){var a=e.call(this,t)||this;return a.setRef=function(e){a.element=e},a.state={height:s.SKELETON.DEFAULT_HEIGHT},a}return a.__extends(t,e),t.prototype.componentDidMount=function(){this.setState({height:this.element&&this.element.clientHeight||s.SKELETON.DEFAULT_HEIGHT})},t.prototype.render=function(){for(var e=s.SKELETON.CARD_HEIGHT,t=Math.ceil(this.state.height/e),a=[],r=0;r<t;r++)a.push(n.default.createElement(d,{key:r,animated:this.props.animated}));return n.default.createElement("div",{className:"folder-history-skeleton",ref:this.setRef},a)},t})(n.default.PureComponent);t.FolderHistoryEventCardsSkeleton=l})),define("modules/clean/react/delorean/components/rewind_graph_page",["require","exports","tslib","react","modules/core/i18n","modules/clean/react/delorean/data/types","modules/clean/react/delorean/data/actions","modules/clean/react/delorean/components/rewind_graph/rewind_graph_component","modules/clean/react/delorean/constants","modules/clean/react/delorean/util","modules/clean/react/delorean/components/rewind_step_header","modules/clean/react/delorean/components/rewind_continue_widget","modules/clean/components/loading_indicator","modules/clean/react/delorean/logging","modules/core/browser","classnames"],(function(e,t,a,n,r,s,o,i,d,l,p,c,u,h,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),h=a.__importStar(h),g=a.__importStar(g),f=a.__importDefault(f);var v=(function(e){function t(t){var a=e.call(this,t)||this;return a.isContinueWidgetVisible=function(){return"loaded"===a.props.page.contents.type&&void 0!==a.props.page.contents.selectedDateTsInMs},a.onSelectDate=function(e,t){var n=a.props,r=n.user,o=n.restoreId;a.props.dispatch({type:s.DeloreanActionType.setRewindPanelSelectedDate,selectedDateString:t,selectedDateTsInMs:e}),h.clickDayGraphDate({user:r,restoreId:o,selectedDateTsInMs:e})},a.onContinue=function(){var e=a.props,t=e.user,n=e.restoreId,r=a.props.page;if("loaded"===r.contents.type&&r.contents.selectedDateString&&r.contents.selectedDateTsInMs){var o=r.contents,i=o.selectedDateString,d=o.selectedDateTsInMs;h.clickDayGraphNext({user:t,restoreId:n,selectedDateTsInMs:d}),a.props.dispatch({type:s.DeloreanActionType.changeRewindPageToActivityListPage,selectedDateTsInMs:d,selectedDateString:i})}},a.navigateOneWeekBack=function(){a.props.dispatch(o.fetchEventCountsAction({user:a.props.user,fqpath:a.props.fqpath,startDaysBack:a.props.page.graphStartOffset+d.REWIND_GRAPH_DAY_STEP,endDaysBack:a.props.page.graphEndOffset+d.REWIND_GRAPH_DAY_STEP,graphPositionChange:"backward"}))},a.navigateOneWeekForward=function(){a.props.dispatch(o.fetchEventCountsAction({user:a.props.user,fqpath:a.props.fqpath,startDaysBack:a.props.page.graphStartOffset-d.REWIND_GRAPH_DAY_STEP,endDaysBack:a.props.page.graphEndOffset-d.REWIND_GRAPH_DAY_STEP,graphPositionChange:"forward"}))},a.onHover=function(e){a.setState({isHovering:e})},a.onContactSupport=function(){g.open_tab("https://www.dropbox.com/support")},a.startedLoadingTimestamp=Date.now(),a.state={isHovering:!1},a}return a.__extends(t,e),t.prototype.componentDidMount=function(){this.props.dispatch(o.fetchEventCountsAction({user:this.props.user,fqpath:this.props.fqpath,startDaysBack:this.props.page.graphStartOffset,endDaysBack:this.props.page.graphEndOffset,graphPositionChange:"none"}))},t.prototype.componentDidUpdate=function(e){var t=this.props,a=t.user,n=t.restoreId,r=this.startedLoadingTimestamp;if("loaded"!==e.page.contents.type&&"loaded"===this.props.page.contents.type){var s=this.props.page.contents.namespaceCount;h.loadDayGraph({user:a,restoreId:n,startedLoadingTimestamp:r,namespaceCount:s})}"error"!==e.page.contents.type&&"error"===this.props.page.contents.type&&h.loadDayGraph({user:a,restoreId:n,startedLoadingTimestamp:r,namespaceCount:0,errorString:this.props.page.contents.errorString})},t.prototype.renderGraphSection=function(){if("initial-load"===this.props.page.contents.type)return n.default.createElement("div",{className:"rewind-graph-panel-container"},n.default.createElement("div",{className:"folder-history-event-list__empty-text"},n.default.createElement(u.LoadingIndicator,{className:"rewind-started-spinner",style:"blue_spinner"})," ",r.intl.formatMessage({id:"4v6Ubi",defaultMessage:"Just a sec…"})));if("error"===this.props.page.contents.type)return n.default.createElement("div",{className:"rewind-graph-panel-container"},n.default.createElement("div",{className:"folder-history-event-list__empty-text"},this.props.page.contents.errorString," ",n.default.createElement("a",{href:"#",onClick:this.onContactSupport},r.intl.formatMessage({id:"K2WP/Z",defaultMessage:"Contact support"}))));if("loaded"===this.props.page.contents.type){var e=this.props.page,t=e.contents.data,a=e.graphStartOffset,s=e.graphEndOffset,o=t.slice(t.length-a,t.length-s),p=this.props.page.contents.data.length-1-(this.props.page.graphStartOffset-1),c=!this.props.page.contents.data[p].outsideHistoryCutoff,h=this.props.page.graphEndOffset>0,g=this.props.page.contents.hasDataThisWeek;return n.default.createElement("div",{className:"rewind-graph-panel-container"},g?n.default.createElement("span",null):n.default.createElement("div",{className:"rewind-graph-no-activity"},n.default.createElement("div",{className:"rewind-graph-no-activity__text"},r.intl.formatMessage({id:"/AeFJk",defaultMessage:"No activity for the selected week"}))),n.default.createElement("div",{className:f.default({"rewind-graph-canvas-and-button":!0,"no-data":!g})},n.default.createElement(i.RewindGraphComponent,{onSelectDate:this.onSelectDate,selectedPointMs:this.props.page.contents.selectedDateTsInMs,data:o,hasData:g,width:d.GRAPH_WIDTH,height:d.GRAPH_HEIGHT,onNavigateOneWeekBack:this.navigateOneWeekBack,onNavigateOneWeekForward:this.navigateOneWeekForward,canNavigateForward:h,canNavigateBackward:c,graphStartOffset:this.props.page.graphStartOffset,graphEndOffset:this.props.page.graphEndOffset,loadingNextWeek:this.props.page.contents.loadingNextWeek,loadingPreviousWeek:this.props.page.contents.loadingPreviousWeek,onHover:this.onHover})))}return l.assertNever(this.props.page.contents)},t.prototype.getGraphTitle=function(){if("loaded"===this.props.page.contents.type&&!this.props.page.contents.selectedDateTsInMs&&this.state.isHovering)return r.intl.formatMessage({id:"E6+0Aw",defaultMessage:"Right before a spike is a good place to start"});var e=Math.floor(this.props.page.graphEndOffset/7);return 0===e?r.intl.formatMessage({id:"Ek+UwA",defaultMessage:"Activity: this week"}):1===e?r.intl.formatMessage({id:"UpWoGT",defaultMessage:"Activity: last week"}):r.intl.formatMessage({id:"b9LPyG",defaultMessage:"{count, plural, one{Activity: {count} weeks ago} other{Activity: {count} weeks ago}}"},{count:e})},t.prototype.render=function(){return n.default.createElement("div",{className:"folder-history-ie11fix"},n.default.createElement("div",{className:"rewind-graph-panel"},n.default.createElement(p.RewindStepHeader,{currentStep:1,maxStep:d.NUM_REWIND_STEPS,instructions:r.intl.formatMessage({id:"eD6onG",defaultMessage:"Pick a day to get started"}),onGoBack:l.noop}),n.default.createElement("div",{className:"rewind-graph-desc"},this.getGraphTitle()),this.renderGraphSection(),n.default.createElement(c.RewindContinueWidget,{onContinue:this.onContinue,visible:this.isContinueWidgetVisible(),text:r.intl.formatMessage({id:"pwmhyJ",defaultMessage:"Now, let’s zoom in"})})))},t})(n.default.PureComponent);t.RewindGraphPage=v})),define("modules/clean/react/delorean/components/rewind_upsell_page",["require","exports","tslib","react","modules/core/browser","modules/core/i18n","modules/clean/static_urls","spectrum/button","modules/clean/react/delorean/logging"],(function(e,t,a,n,r,s,o,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),r=a.__importStar(r),d=a.__importStar(d);var l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){d.clickUpsell({user:t.props.user,restoreId:t.props.restoreId}),r.open_tab("https://www.dropbox.com/plus?_tk=rewind_panel_upgrade")},t.goToHelpCenter=function(){d.clickUpsellHelp({user:t.props.user,restoreId:t.props.restoreId}),r.open_tab("https://help.dropbox.com/security/rewind")},t}return a.__extends(t,e),t.prototype.render=function(){return n.default.createElement("div",{className:"rewind-upsell"},n.default.createElement("div",{className:"rewind-text"},n.default.createElement("div",{className:"rewind-upsell__image"},n.default.createElement("img",{alt:"",src:o.static_url("/static/images/delorean/illo-upsell@1x-vflKV6aIU.png")})),n.default.createElement("div",{className:"rewind-text__title rewind-upsell__title"},s.intl.formatMessage({id:"UjNP9a",defaultMessage:"Rewind to a previous time"})),n.default.createElement("div",{className:"rewind-text__text"},s.intl.formatMessage({id:"W3Vpv5",defaultMessage:"When a lot goes wrong, Dropbox Rewind can help you undo it all. That way you can get back to the way things were."})),n.default.createElement(i.Button,{variant:"primary",className:"rewind-upsell__button",onClick:this.onClick},s.intl.formatMessage({id:"PJ4sk8",defaultMessage:"Get Rewind"})),n.default.createElement("a",{href:"#",className:"rewind-text__centered-link",onClick:this.goToHelpCenter},s.intl.formatMessage({id:"ySR8HJ",defaultMessage:"How Rewind works"}))))},t})(n.default.PureComponent);t.RewindUpsellPage=l})),define("modules/clean/react/delorean/components/rewind_graph/rewind_graph_component",["require","exports","tslib","external/lodash","classnames","react","modules/clean/react/delorean/constants","modules/clean/react/delorean/components/rewind_graph/graph","modules/clean/react/delorean/components/rewind_graph/rewind_graph_buttons","modules/clean/react/delorean/components/rewind_graph/rewind_graph_fallback"],(function(e,t,a,n,r,s,o,i,d,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importStar(n),r=a.__importDefault(r),s=a.__importDefault(s);var p="#0070e0",c="#e6e8eb",u={start:"#eeeeee",end:"#97caff",type:"pulse"},h=function(e){return"before graph"!==e&&"after graph"!==e&&void 0!==e},g=(function(e){function t(t){var a=e.call(this,t)||this;return a.dateLines=[],a.createGraph=function(){a.graph&&a.graph.dispose(),a.graph=new i.Graph({width:a.props.width,height:a.props.height,canvas:a.canvasRef,invisible:!a.props.hasData}),a.graph.addLine({type:"line",start:{x:0,y:a.props.height},end:{x:a.props.width,y:a.props.height},color:{value:c,type:"solid"}}),a.graph.addLine({type:"line",start:{x:0,y:0},end:{x:a.props.width,y:0},color:{value:c,type:"solid"}});var e=a.getNormalizedPoints(a.props.data);a.blueGradient=a.graph.addGradient({type:"gradient",points:e,startColor:{value:"rgba(0, 119, 237, 0.16",type:"solid"},endColor:{value:"rgba(0, 121, 242, 0.04",type:"solid"}}),a.grayGradient=a.graph.addGradient({type:"gradient",points:e,startColor:{value:"rgba(253, 253, 253, 1.0)",type:"solid"},endColor:{value:"rgba(253, 253, 253, 1.0)",type:"solid"}}),a.dateLines=e.map((function(e){var t=e.x;return a.graph.addLine({type:"line",start:{x:t,y:0},end:{x:t,y:a.props.height},color:{value:c,type:"solid"},dashed:"solid"})})),a.blueSpline=a.graph.addSpline({type:"spline",points:e,color:{type:"solid",value:p}}),a.graySpline=a.graph.addSpline({type:"spline",points:e,color:{type:"solid",value:c}}),a.selectedLine=a.graph.addLine({type:"line",start:{x:0,y:0},end:{x:0,y:a.props.height},color:{type:"solid",value:p},invisible:!0}),a.hoveredLine=a.graph.addLine({type:"line",start:{x:0,y:0},end:{x:0,y:a.props.height},color:{type:"solid",value:p},dashed:"pulsing",invisible:!0})},a.createEmptyGraph=function(){a.emptyGraph&&a.emptyGraph.dispose(),a.emptyGraph=new i.Graph({width:a.props.width,height:a.props.height,canvas:a.canvasRef,invisible:a.props.hasData}),a.emptyGraph.addLine({type:"line",start:{x:0,y:a.props.height},end:{x:a.props.width,y:a.props.height},color:{value:c,type:"solid"}}),a.emptyGraph.addLine({type:"line",start:{x:0,y:0},end:{x:a.props.width,y:0},color:{value:c,type:"solid"}})},a.updateGraph=function(){var e=a.getSelectedPoint();if(a.graph&&a.emptyGraph&&(a.graph.invisible=!a.props.hasData,a.emptyGraph.invisible=a.props.hasData,a.props.hasData)){for(var t=!a.state.isHovered&&void 0!==e&&"before graph"!==e&&"after graph"!==e,n=0,r=a.dateLines;n<r.length;n++){var s=r[n];a.state.isHovered||void 0!==e?s.color={type:"solid",value:c}:s.color=u,s.invisible=t}var o,i=a.getSelectedPoint()||a.state.hoveredPoint,d={topLeft:{x:0,y:0},size:{x:o="after graph"===i?a.props.width:void 0===i||"before graph"===i?0:i.x,y:a.props.height}},l={topLeft:{x:o,y:0},size:{x:a.props.width,y:a.props.height}};a.blueGradient.clip=d,a.blueSpline.clip=d,a.grayGradient.clip=l,a.graySpline.clip=l;var p=a.state.hoveredPoint;a.hoveredLine.invisible=!p,p&&(a.hoveredLine.start.x=p.x,a.hoveredLine.end.x=p.x),a.selectedLine.invisible=!h(e),e&&h(e)&&(a.selectedLine.start.x=e.x,a.selectedLine.end.x=e.x)}},a.updateRef=function(e){e&&(a.canvasRef=e,a.createGraph(),a.createEmptyGraph())},a.onMouseMove=function(e){var t=e.currentTarget.getBoundingClientRect(),r=e.clientX-t.left,s=n.minBy(a.getNormalizedPoints(a.props.data),(function(e){return Math.abs(e.x-r)}));a.setState({hoveredPoint:s})},a.setDateRef=function(e){a.dateRef=e},a.onClick=function(){a.state.hoveredPoint&&a.props.onSelectDate(a.state.hoveredPoint.event.dateTsInMs,a.state.hoveredPoint.event.dateString)},a.onMouseOver=function(){a.setState({isHovered:!0}),a.props.onHover(!0)},a.onMouseOut=function(e){a.setState({isHovered:!1,hoveredPoint:void 0}),a.props.onHover(!1)},a.navigateOneWeekBack=function(){a.props.onNavigateOneWeekBack()},a.navigateOneWeekForward=function(){a.props.onNavigateOneWeekForward()},a.state={hoveredPoint:void 0,isHovered:!1},a}return a.__extends(t,e),t.prototype.componentWillUpdate=function(e){var t=this.getNormalizedPoints(e.data);this.blueSpline.points=t,this.graySpline.points=t,this.blueGradient.points=t,this.grayGradient.points=t},t.prototype.getSelectedPoint=function(){var e=this,t=this.getNormalizedPoints(this.props.data);if(void 0!==this.props.selectedPointMs){var a=this.getNormalizedPoints(this.props.data).find((function(t){return t.event.dateTsInMs===e.props.selectedPointMs}));return a||(this.props.selectedPointMs<t[0].event.dateTsInMs?"before graph":this.props.selectedPointMs>t[t.length-1].event.dateTsInMs?"after graph":void 0)}},t.prototype.getNormalizedPoints=function(e){var t=this,a=e.map((function(e,t){return{eventCount:e,x:t,y:e.count}})),r=n.minBy(a,(function(e){return e.x})).x,s=n.maxBy(a,(function(e){return e.x})).x,i=n.minBy(a,(function(e){return e.y})).y,d=n.maxBy(a,(function(e){return e.y})).y;return 0===s&&(s=1),0===d&&(d=1),a.map((function(e){var a=e.x,n=e.y,l=e.eventCount,p=(n-i)/d;return{x:(a-r)/s*t.props.width,y:t.props.height-Math.max(o.GRAPH_BOTTOM_PADDING,p*t.props.height),event:l}}))},t.prototype.render=function(){var e=this.state.hoveredPoint?this.state.hoveredPoint.event.dateString:"";this.updateGraph();var t=0;return this.state.hoveredPoint&&((t=this.state.hoveredPoint.x-o.DATE_LABEL_WIDTH/2)<0&&(t=0),t>this.props.width-o.DATE_LABEL_WIDTH&&(t=this.props.width-o.DATE_LABEL_WIDTH)),s.default.createElement("div",null,s.default.createElement("div",{style:{paddingLeft:t+"px"}},this.props.hasData?s.default.createElement("div",{ref:this.setDateRef,className:"rewind-graph-date-label"},e):s.default.createElement("div",{className:"rewind-graph-date-label-spacer"})),s.default.createElement("canvas",{width:this.props.width,height:this.props.height,className:r.default({"rewind-graph-canvas":!0,"no-data":!this.props.hasData}),ref:this.updateRef,onMouseMove:this.props.hasData?this.onMouseMove:void 0,onClick:this.props.hasData?this.onClick:void 0,onMouseOver:this.props.hasData?this.onMouseOver:void 0,onMouseOut:this.props.hasData?this.onMouseOut:void 0},s.default.createElement(l.RewindGraphAccessibilityText,{data:this.props.data,onSelectDate:this.props.onSelectDate})),s.default.createElement("div",{className:"rewind-graph-nav"},s.default.createElement(d.GraphBackwardButton,{daysBackward:this.props.graphStartOffset,canNavigate:this.props.canNavigateBackward,onNavigateOneWeekBack:this.navigateOneWeekBack,loading:this.props.loadingPreviousWeek,disabled:this.props.loadingNextWeek||this.props.loadingPreviousWeek}),s.default.createElement(d.GraphForwardButton,{daysForward:this.props.graphEndOffset,canNavigate:this.props.canNavigateForward,onNavigateOneWeekForward:this.navigateOneWeekForward,loading:this.props.loadingNextWeek,disabled:this.props.loadingNextWeek||this.props.loadingPreviousWeek})))},t})(s.default.PureComponent);t.RewindGraphComponent=g})),define("modules/clean/react/delorean/components/rewind_graph/rewind_graph_buttons",["require","exports","tslib","react","spectrum/button","modules/clean/components/loading_indicator","modules/core/i18n","modules/clean/react/delorean/util","modules/clean/datetime"],(function(e,t,a,n,r,s,o,i,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),t.GraphForwardButton=function(e){var t=e.canNavigate,a=e.daysForward,l=e.loading,p=e.onNavigateOneWeekForward,c=e.disabled;return t?n.default.createElement(r.Button,{"aria-label":o.intl.formatMessage({id:"rJUytN",defaultMessage:"Go forward one week"}),variant:"borderless",className:"rewind-graph-nav__btn",disabled:c,onClick:c?void 0:p},l&&n.default.createElement(s.LoadingIndicator,{style:"blue_spinner"}),i.formatWithShortDateName(d.increment_date(new Date,0,0,1-a))," ›"):n.default.createElement(r.Button,{disabled:!0,variant:"borderless"},o.intl.formatMessage({id:"JDRaFD",defaultMessage:"Today"}))},t.GraphBackwardButton=function(e){var t=e.canNavigate,a=e.daysBackward,l=e.loading,p=e.onNavigateOneWeekBack,c=e.disabled;return t?n.default.createElement(r.Button,{"aria-label":o.intl.formatMessage({id:"r409m+",defaultMessage:"Go back one week"}),variant:"borderless",className:"rewind-graph-nav__btn",disabled:c,onClick:c?void 0:p},"‹ ",i.formatWithShortDateName(d.increment_date(new Date,0,0,-a)),l&&n.default.createElement(s.LoadingIndicator,{style:"blue_spinner"})):n.default.createElement("span",null," ")}})),define("modules/clean/react/delorean/components/rewind_graph/graph",["require","exports","tslib","modules/clean/react/delorean/util","modules/clean/react/delorean/constants","external/lodash"],(function(e,t,a,n,r,s){"use strict";function o(e,t,a){var n=parseInt(e.replace(/#/g,""),16),r=parseInt(t.replace(/#/g,""),16),s=n>>16,o=n>>8&255,i=255&n;return"#"+((1<<24)+(s+a*((r>>16)-s)<<16)+(o+a*((r>>8&255)-o)<<8)+(i+a*((255&r)-i))|0).toString(16).slice(1)}Object.defineProperty(t,"__esModule",{value:!0}),s=a.__importStar(s),t.lerpColor=o;var i=(function(){function e(e){var t=this;this.disposed=!1,this.shapes=[],this.animationTick=0,this.addLine=function(e){return t.shapes.push(e),e},this.addSpline=function(e){return t.shapes.push(e),e},this.addGradient=function(e){return t.shapes.push(e),e},this.renderCanvas=function(){if(window.requestAnimationFrame(t.renderCanvas),!t.invisible){t.context.save(),t.animationTick++,t.context.clearRect(0,0,t.width,t.height);for(var e=0,a=t.shapes;e<a.length;e++){var n=a[e];if(!n.invisible){if(t.context.save(),n.clip){var r=n.clip,s=r.topLeft,o=r.size;t.context.beginPath(),t.context.rect(s.x,s.y,o.x,o.y),t.context.clip()}t.renderShape(n),t.context.restore()}}t.context.restore()}},this.renderShape=function(e){return"line"===e.type?t.renderLine(e):"spline"===e.type?t.renderSpline(e):"gradient"===e.type?t.renderGradient(e):n.assertNever(e)},this.getColorValue=function(e){return"solid"===e.type?e.value:"pulse"===e.type?o(e.start,e.end,(Math.sin(t.animationTick/20)+1)/2):n.assertNever(e)},this.renderLine=function(e){if(t.context.beginPath(),t.context.strokeStyle=t.getColorValue(e.color),t.context.lineWidth=r.DEFAULT_GRAPH_LINE_WIDTH,e.dashed)if("pulsing"===e.dashed){var a=(Math.sin(t.animationTick/20)+1)/2*5;t.context.lineDashOffset=a,t.context.setLineDash([10-a,a])}else"solid"===e.dashed?t.context.setLineDash([4,4]):n.assertNever(e.dashed);t.context.moveTo(e.start.x,e.start.y),t.context.lineTo(e.end.x,e.end.y),t.context.stroke()},this.renderSpline=function(e){var a=r.DEFAULT_GRAPH_LINE_WIDTH;t.context.beginPath(),t.addGraphPathToContext(e.points,a),t.context.strokeStyle=t.getColorValue(e.color),t.context.lineWidth=a,t.context.stroke()},this.renderGradient=function(e){var a=r.DEFAULT_GRAPH_LINE_WIDTH;t.context.beginPath(),t.context.moveTo(0,t.height),t.addGraphPathToContext(e.points,a),t.context.lineTo(t.width,t.height),t.context.closePath(),t.context.clip();var n=t.context.createLinearGradient(0,0,0,t.height);!!window.MSInputMethodContext&&!!document.documentMode||(n.addColorStop(0,t.getColorValue(e.startColor)),n.addColorStop(1,t.getColorValue(e.endColor)),t.context.fillStyle=n,t.context.fillRect(0,0,t.width,t.height))},this.dispose=function(){t.disposed=!0,t.shapes=[]};var a=e.width,s=e.height,i=e.canvas,d=e.invisible;this.canvas=i,this.context=i.getContext("2d"),this.width=a,this.height=s,this.invisible=d,this.context&&(this.context.translate(.5,.5),i.style.width=a+"px",i.style.height=s+"px",i.width=a*window.devicePixelRatio,i.height=s*window.devicePixelRatio,this.context.scale(window.devicePixelRatio,window.devicePixelRatio),window.requestAnimationFrame(this.renderCanvas))}return e.prototype.addGraphPathToContext=function(e,t){var n=[];e=a.__spreadArrays([e[0],e[0]],e,[e[e.length-1]]);for(var r=s.maxBy(e,(function(e){return e.y})).y,o=s.minBy(e,(function(e){return e.y})).y+t,i=2;i<e.length-2;i++)for(var d=0;d<=16;d++){var l=.5*(e[i+1].x-e[i-1].x),p=.5*(e[i+2].x-e[i].x),c=.5*(e[i+1].y-e[i-1].y),u=.5*(e[i+2].y-e[i].y),h=d/16,g=2*Math.pow(h,3)-3*Math.pow(h,2)+1,f=-2*Math.pow(h,3)+3*Math.pow(h,2),v=Math.pow(h,3)-2*Math.pow(h,2)+h,m=Math.pow(h,3)-Math.pow(h,2),_=g*e[i].x+f*e[i+1].x+v*l+m*p,y=g*e[i].y+f*e[i+1].y+v*c+m*u;y>r&&(y=r),y<o&&(y=o),n.push({x:_,y:y})}for(i=1;i<n.length;i++)this.context.lineTo(n[i].x,n[i].y)},e})();t.Graph=i})),define("modules/clean/react/delorean/components/rewind_nux",["require","exports","tslib","react","modules/core/browser","modules/core/i18n","modules/clean/static_urls","spectrum/button","modules/clean/react/delorean/logging","modules/clean/react/delorean/data/actions","modules/clean/react/trash/restorations_education"],(function(e,t,a,n,r,s,o,i,d,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),r=a.__importStar(r),d=a.__importStar(d);var c=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.goToHelpCenter=function(){var e=t.props,a=e.user,n=e.restoreId;d.clickNUXHelp({user:a,restoreId:n}),r.unsafe_open_tab("https://help.dropbox.com/security/rewind")},t.onDismiss=function(){var e=t.props,a=e.user,n=e.restoreId;d.clickNUXNext({user:a,restoreId:n}),t.props.dispatch(l.dismissNUXAction())},t}return a.__extends(t,e),t.prototype.render=function(){var e;return e=this.props.versionHistoryLength?s.intl.formatMessage({id:"ASRI+S",defaultMessage:"When a lot went wrong, undo everything by going back to any time in the last {version_history_length} days."},{version_history_length:this.props.versionHistoryLength}):s.intl.formatMessage({id:"KmONom",defaultMessage:"When a lot went wrong, undo everything by going back to any time in the past."}),n.default.createElement("div",{className:"rewind-nux"},n.default.createElement("div",{className:"rewind-text"},n.default.createElement("div",{className:"rewind-text__image"},n.default.createElement("img",{alt:"",src:o.static_url("/static/images/delorean/illo-folders@2x-vflmf44mp.png")})),n.default.createElement("div",{className:"rewind-text__title rewind-nux__title"},s.intl.formatMessage({id:"Cz9tal",defaultMessage:"Rewind to a previous time"})),n.default.createElement("div",{className:"rewind-text__text"},e),n.default.createElement(i.Button,{className:"rewind-text__button",onClick:this.onDismiss},s.intl.formatMessage({id:"kOQNUE",defaultMessage:"Get started"})),n.default.createElement("a",{href:"#",className:"rewind-text__centered-link",onClick:this.goToHelpCenter},s.intl.formatMessage({id:"qLPTw+",defaultMessage:"How Rewind works"}))),n.default.createElement(p.RestorationOptions,{deletedFile:!0,olderFileVersion:!0,user:this.props.user}))},t})(n.default.Component);t.RewindNUX=c})),define("modules/clean/react/delorean/components/rewind",["require","exports","tslib","react","modules/clean/react/delorean/components/rewind_nux","modules/clean/react/delorean/data/types","modules/clean/react/delorean/components/rewind_graph_page","modules/clean/react/delorean/components/rewind_confirmation_page","modules/clean/react/delorean/components/rewind_started","modules/clean/react/delorean/components/rewind_activity_list_page","modules/clean/react/delorean/components/rewind_upsell_page"],(function(e,t,a,n,r,s,o,i,d,l,p){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.renderNUXPage=function(){return n.default.createElement(r.RewindNUX,{versionHistoryLength:this.props.userVersionHistoryLength,user:this.props.user,restoreId:this.props.restorationsLoggingId,dispatch:this.props.dispatch})},t.prototype.renderGraphPage=function(e){return n.default.createElement(o.RewindGraphPage,{user:this.props.user,fqpath:this.props.fqpath,page:e,dispatch:this.props.dispatch,events:this.props.events,restoreId:this.props.restorationsLoggingId})},t.prototype.renderConfirmationPage=function(e){if(e.eventAboveDivider){var t=void 0;return t="loaded"===this.props.graphPage.contents.type?this.props.graphPage.contents.data:[],n.default.createElement(i.RewindConfirmationPage,{user:this.props.user,fqpath:this.props.fqpath,eventToRewindTo:e.eventAboveDivider,folderName:this.props.folderName,dispatch:this.props.dispatch,page:e,graphPage:this.props.graphPage,restoreId:this.props.restorationsLoggingId,eventCounts:t})}return null},t.prototype.renderStartedPage=function(e){return n.default.createElement(d.RewindStarted,{user:this.props.user,folderName:this.props.folderName,page:e,dispatch:this.props.dispatch,rewindState:e.rewindState,restoreId:this.props.restorationsLoggingId,closePanel:this.props.closePanel})},t.prototype.renderActivityListPage=function(e){return n.default.createElement(l.RewindActivityListPage,{dispatch:this.props.dispatch,user:this.props.user,fqpath:this.props.fqpath,browseContext:this.props.browseContext,events:this.props.events,selectedDateTsInMs:e.selectedDateTsInMs,restoreId:this.props.restorationsLoggingId,isForRewindFlow:!0})},t.prototype.renderUpsellPage=function(e){return n.default.createElement(p.RewindUpsellPage,{user:this.props.user,restoreId:this.props.restorationsLoggingId})},t.prototype.render=function(){switch(this.props.data.page){case s.RewindFlowPage.notVisible:return null;case s.RewindFlowPage.NUXPage:return this.renderNUXPage();case s.RewindFlowPage.confirmationPage:return this.renderConfirmationPage(this.props.data);case s.RewindFlowPage.graphPage:return this.renderGraphPage(this.props.data);case s.RewindFlowPage.activityListPage:return this.renderActivityListPage(this.props.data);case s.RewindFlowPage.startedPage:return this.renderStartedPage(this.props.data);case s.RewindFlowPage.upsellPage:return this.renderUpsellPage(this.props.data)}},t})((n=a.__importDefault(n)).default.PureComponent);t.Rewind=c})),define("modules/clean/react/delorean/components/rewind_title",["require","exports","tslib","react","modules/clean/react/sprite","modules/clean/react/delorean/constants","modules/clean/react/title_bubble","modules/core/i18n"],(function(e,t,a,n,r,s,o,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(){t.props.clickClosePanel({closedByClick:!0})},t}return a.__extends(t,e),t.prototype.render=function(){return n.default.createElement("section",{className:"rewind-title"},n.default.createElement("div",{className:"rewind-title__header"},n.default.createElement("div",{className:"rewind-title__header-text"},this.props.title),n.default.createElement(o.TitleBubble,{content:i.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),position:o.TitleBubble.POSITIONS.LEFT,distanceFromTarget:s.BUBBLE_DISTANCE},n.default.createElement(r.Sprite,{onClick:this.onClick,className:"rewind-title__back",group:"web",name:"s_sidebar_hide",alt:i.intl.formatMessage({id:"XOXGdD",defaultMessage:"Close Sidebar"})}))))},t})((n=a.__importDefault(n)).default.Component),l=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.clickClosePanel=function(){t.props.closePanel({closedByClick:!0})},t}return a.__extends(t,e),t.prototype.getTitle=function(){var e=this.props,t=e.expFolderHistoryRollbacks,a=e.context;return t?a.isCurrentlyInRoot?i.intl.formatMessage({id:"hiHRLr",defaultMessage:"Rewind Dropbox"}):i.intl.formatMessage({id:"eH7zsu",defaultMessage:"Rewind {folder}"},{folder:this.props.folderDisplayName}):i.intl.formatMessage({id:"BxyH89",defaultMessage:"Folder history"})},t.prototype.render=function(){return n.default.createElement(d,{title:this.getTitle(),clickClosePanel:this.clickClosePanel})},t})(n.default.Component);t.RewindTitle=l;var p=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(t,e),t.prototype.render=function(){return n.default.createElement(d,{title:i.intl.formatMessage({id:"aZ+0Zw",defaultMessage:"Folder History"}),clickClosePanel:this.props.clickClosePanel})},t})(n.default.Component);t.FolderHistoryTitle=p})),define("modules/clean/react/delorean/data/actions",["require","exports","tslib","modules/clean/react/delorean/data/types","modules/core/i18n","modules/clean/react/delorean/data/api","modules/clean/viewer","modules/clean/react/delorean/data/selectors","modules/clean/react/delorean/util","modules/clean/react/delorean/constants"],(function(e,t,a,n,r,s,o,i,d,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s=a.__importStar(s),t.dismissNUXAction=function(){var e=this;return function(t){return a.__awaiter(e,void 0,void 0,(function(){return a.__generator(this,(function(e){return t({type:n.DeloreanActionType.dismissNUX}),t({type:n.DeloreanActionType.changeRewindPageToGraphPage}),[2]}))}))}},t.fetchEventCountsAction=function(e){var t=this;return function(o,i){return a.__awaiter(t,void 0,void 0,(function(){var t,i,p,c,u,h,g,f,v,m,_,y,w,P,D,E,R,b,T,C,x,M,N,S,k,A,I;return a.__generator(this,(function(a){switch(a.label){case 0:t=e.startDaysBack,i=e.endDaysBack,p=e.user,c=e.fqpath,u=e.graphPositionChange,h=new Date,(g=new Date).setDate(g.getDate()-t-1),g.setHours(0,0,0,0),h.setDate(h.getDate()+1-i),h.setHours(0,0,0,0),"none"!==u&&o({type:n.DeloreanActionType.setLoadingGraphWeek,graphPositionChange:u}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,s.fetchEventCounts({user:p,fqpath:c,startDate:g,endDate:h,aggregation:"daily"})];case 2:return f=a.sent(),[3,4];case 3:return v=a.sent(),m=v&&v.error&&v.error.err&&v.error.err[".tag"],_=r.intl.formatMessage({id:"kvj0Bl",defaultMessage:"There was an internal Dropbox error, but we can still help you use Rewind."}),v&&v.raw&&504===v.raw.status&&(_=r.intl.formatMessage({id:"Z1gIYu",defaultMessage:"There were too many changes for us to display, but we can still help you use Rewind."})),"invalid_arguments"===m||"internal_error"===m?_=r.intl.formatMessage({id:"kvj0Bl",defaultMessage:"There was an internal Dropbox error, but we can still help you use Rewind."}):"access_error"===m?_=r.intl.formatMessage({id:"+C1mk4",defaultMessage:"You do not have permission to view this location."}):"unsupported_version"===m&&(_=r.intl.formatMessage({id:"h4NBWz",defaultMessage:"Please refresh your browser."})),o({type:n.DeloreanActionType.setRewindEventCountsError,errorString:_}),[2];case 4:for(y=[],w=new Date,P=0,D=f.counts;P<D.length;P++)E=D[P],R=E.count,b=E.start_ts,T=E.outside_history_cutoff,C=1e3*b,x=new Date(C),M=d.formatWithShortDateName(x),x>w||y.push({dateString:M,count:R,dateTsInMs:C,outsideHistoryCutoff:T});return o({type:n.DeloreanActionType.loadEventCounts,eventCounts:y,namespaceCount:f.namespace_count||0,changedNamespaceCount:f.changed_namespace_count||0}),"forward"===u?(N=l.REWIND_GRAPH_DAY_STEP,S=d.floorDate(new Date),void 0!==(k=d.findIndex(y,(function(e){return d.floorDate(new Date(e.dateTsInMs))>=S})))&&(N=Math.max(k-1,0)),o({type:n.DeloreanActionType.setGraphRangeForward,length:N})):"backward"===u?(A=d.findLastIndex(y,(function(e){return e.outsideHistoryCutoff})),I=l.REWIND_GRAPH_DAY_STEP,void 0!==A&&(I=y.length-A),o({type:n.DeloreanActionType.setGraphRangeBack,length:I})):"none"===u||d.assertNever(u),o({type:n.DeloreanActionType.setGraphLoadFinished}),[2]}}))}))}},t.fetchEventsAction=function(e){var t=this;return function(r,o){return a.__awaiter(t,void 0,void 0,(function(){var t;return a.__generator(this,(function(a){switch(a.label){case 0:return[4,s.fetchEventsApi(e)];case 1:return t=a.sent(),r({type:n.DeloreanActionType.setEventsLoaded,events:t.events||[],user:e.user,direction:e.direction,cursor:t.cursor?{type:"has-cursor",cursor:t.cursor}:{type:"reached-end"},hasMore:t.has_more||!1}),e.done&&e.done(),[2]}}))}))}},t.initializeDeloreanAction=function(e){var t=e.browseContext,a=e.user,r=e.openToRewind;return{type:n.DeloreanActionType.initialize,browseContext:t,user:a,openToRewind:r,viewer:o.Viewer.get_viewer()}},t.showMoreAction=function(e){var t=this,r=e.direction;return function(o,d){return a.__awaiter(t,void 0,void 0,(function(){var t,l;return a.__generator(this,(function(a){switch(a.label){case 0:return o({type:n.DeloreanActionType.setFolderHistoryPaginationLoading,direction:e.direction}),"processedEvents"in(t=i.getEvents(d()))?t.processedEvents[t.processedEvents.length-1].type!==n.DeloreanEventType.event?[2]:[4,s.fetchMoreEventsApi({userId:e.user.id,fqpath:e.fqpath,cursorObj:e.direction===n.PaginationDirection.future?e.futureCursor:e.pastCursor,direction:r})]:[2];case 1:return l=a.sent(),o({type:n.DeloreanActionType.setFolderHistoryPaginationLoaded,user:e.user,events:l.events||[],cursor:l.has_more?{type:"has-cursor",cursor:l.cursor}:{type:"reached-end"},hasMore:l.has_more||!1,direction:r}),e.done&&e.done(l.events?l.events.length:0),[2]}}))}))}}})),define("modules/clean/react/delorean/data/api",["require","exports","tslib","modules/clean/api_v2/user_client","modules/clean/react/delorean/util","modules/clean/react/delorean/data/types","modules/clean/react/delorean/constants","modules/clean/react/snackbar","modules/core/i18n"],(function(e,t,a,n,r,s,o,i,d){"use strict";function l(e){"unsupported_version"===(e&&e.error&&e.error.err&&e.error.err[".tag"])&&i.Snackbar.fail(d.intl.formatMessage({id:"H0vBqO",defaultMessage:"Dropbox is out of date. Please refresh your browser."}),"delorean-unsupported-version")}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchEventsApi=function(e){return a.__awaiter(this,void 0,Promise,(function(){var t,r;return a.__generator(this,(function(a){switch(a.label){case 0:t={path:e.fqpath,version:o.API_VERSION,direction:e.direction===s.PaginationDirection.future?{".tag":"future"}:{".tag":"past"},timestamp:e.timestampInSeconds?e.timestampInSeconds:o.API_TIMESTAMP_NOW,filter:{only_rewindable:e.onlyRewindableEvents}},a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(new n.UserApiV2Client).ns("chronicle").rpc("list_events",t,{subjectUserId:e.user.id})];case 2:return[2,a.sent()];case 3:throw l(r=a.sent()),r;case 4:return[2]}}))}))},t.fetchMoreEventsApi=function(e){return a.__awaiter(this,void 0,Promise,(function(){var t,r,i,d;return a.__generator(this,(function(a){t=e.cursorObj,r=e.fqpath,i=e.direction,d={cursor:t.cursor,path:r,direction:i===s.PaginationDirection.future?{".tag":"future"}:{".tag":"past"},version:o.API_VERSION};try{return[2,(new n.UserApiV2Client).ns("chronicle").rpc("list_events",d,{subjectUserId:e.userId})]}catch(e){throw l(e),e}return[2]}))}))},t.beginRewind=function(e){var t={path:""===e.path?"/":e.path,target_ts_microseconds:e.targetTsMicroseconds,type:{".tag":"individual"},logging_restore_id:e.restorationsLoggingId.value};return(new n.UserApiV2Client).ns("restorations").rpc("rewinds/start",t,{subjectUserId:e.user.id})},t.getRewindStatus=function(e){return a.__awaiter(this,void 0,Promise,(function(){var t;return a.__generator(this,(function(a){switch(a.label){case 0:return t={id:e.id},[4,(new n.UserApiV2Client).ns("restorations").rpc("rewinds/status",t,{subjectUserId:e.user.id})];case 1:return[2,a.sent()]}}))}))},t.fetchEventCounts=function(e){return a.__awaiter(this,void 0,Promise,(function(){var t,s,i,d,p,c;return a.__generator(this,(function(a){switch(a.label){case 0:if(t=e.startDate,s=e.endDate,d=Math.floor(t.getTime()/1e3),p=Math.floor(s.getTime()/1e3),d>p)throw new Error("startTs must come before endTs.");if("hourly"===e.aggregation)i={".tag":"hourly"};else{if("daily"!==e.aggregation)return[2,r.assertNever(e.aggregation)];i={".tag":"daily"}}a.label=1;case 1:return a.trys.push([1,3,,4]),[4,(new n.UserApiV2Client).ns("chronicle").rpc("get_event_counts",{path:e.fqpath,start_ts:d,end_ts:p,aggregation:i,version:o.API_VERSION},{subjectUserId:e.user.id})];case 2:return[2,a.sent()];case 3:throw l(c=a.sent()),c;case 4:return[2]}}))}))}})),define("modules/clean/react/delorean/data/reducers",["require","exports","tslib","modules/clean/filepath","modules/clean/react/delorean/util","modules/clean/react/delorean/util","modules/clean/react/delorean/data/types","modules/clean/react/delorean/data/reducer_helpers"],(function(e,t,a,n,r,s,o,i){"use strict";var d;function l(e,t){var n,d=e.events.type===o.RewindEventState.hasContent?e.events.processedEvents:[],l=t.events.map((function(a){return i.getProcessedEvent({event:a,path:e.fqpath,currentFolder:e.folderName,user:t.user})})),p=e.events.type===o.RewindEventState.hasContent?e.events.cursorFuture:{type:"never-fetched"},c=e.events.type===o.RewindEventState.hasContent?e.events.cursorPast:{type:"never-fetched"};t.direction===o.PaginationDirection.future?(n=s.filterType(a.__spreadArrays(l,d),(function(e){return e.type===o.DeloreanEventType.event})),p=t.hasMore?t.cursor:{type:"reached-end"}):(n=s.filterType(a.__spreadArrays(d,l),(function(e){return e.type===o.DeloreanEventType.event})),c=t.hasMore?t.cursor:{type:"reached-end"});for(var u=[],h=void 0,g=0,f=n=n.sort((function(e,t){return t.timestamp-e.timestamp}));g<f.length;g++){var v=f[g];h&&v.eventCardDate===h.eventCardDate||u.push({type:o.DeloreanEventType.dateBanner,eventCardDate:v.eventCardDate,date:r.floorDate(new Date(v.timestamp))}),u.push(v),h=v}var m=!1,_=!1;return e.events.type===o.RewindEventState.hasContent&&(m=t.direction!==o.PaginationDirection.past&&e.events.loadingPastPage,_=t.direction!==o.PaginationDirection.future&&e.events.loadingFuturePage),a.__assign(a.__assign({},e),{events:{type:o.RewindEventState.hasContent,loadingPastPage:m,loadingFuturePage:_,processedEvents:u,cursorFuture:p,cursorPast:c}})}function p(e,t){var n;if("loaded"!==e.pageData.graphPage.contents.type)return e;var r=t.type===o.DeloreanActionType.setGraphRangeBack,s=e.pageData.graphPage.graphStartOffset+(r?t.length:-t.length),d=e.pageData.graphPage.graphEndOffset+(r?t.length:-t.length);return a.__assign(a.__assign({},e),{pageData:a.__assign(a.__assign({},e.pageData),(n={},n[o.RewindFlowPage.graphPage]=a.__assign(a.__assign({},e.pageData.graphPage),{graphStartOffset:s,graphEndOffset:d,contents:a.__assign(a.__assign({},e.pageData.graphPage.contents),{type:"loaded",hasDataThisWeek:i.checkHasDataThisWeek(e.pageData.graphPage.contents.data,s,d)})}),n))})}Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importStar(n),r=a.__importStar(r),t.defaultDeloreanState={hasDismissedNUX:!1,pageData:(d={},d[o.RewindFlowPage.notVisible]={page:o.RewindFlowPage.notVisible},d[o.RewindFlowPage.NUXPage]={page:o.RewindFlowPage.NUXPage},d[o.RewindFlowPage.graphPage]={page:o.RewindFlowPage.graphPage,contents:{type:"initial-load"},graphStartOffset:7,graphEndOffset:0},d[o.RewindFlowPage.confirmationPage]={page:o.RewindFlowPage.confirmationPage,eventAboveDivider:void 0},d[o.RewindFlowPage.activityListPage]={page:o.RewindFlowPage.activityListPage,selectedDateTsInMs:0,selectedDateString:""},d[o.RewindFlowPage.startedPage]={page:o.RewindFlowPage.startedPage,rewindState:o.RewindState.InProgress,rewindId:"",selectedEvent:void 0},d[o.RewindFlowPage.upsellPage]={page:o.RewindFlowPage.upsellPage},d),activePage:o.RewindFlowPage.notVisible,folderDisplayName:"",rootDisplayName:"",folderName:"",fqpath:"",events:{type:o.RewindEventState.loadingEntirePanel}},t.reducer=function(e,r){switch(void 0===e&&(e=t.defaultDeloreanState),r.type){case o.DeloreanActionType.initialize:return(function(e,r){var s=r.browseContext,d=r.user,l=r.viewer,p=r.openToRewind,c=n.normalize(s.currentFQPath),u=i.getRootFolderName(d,l),h="";h=""===c?u:n.child_dir(c);var g=t.defaultDeloreanState;return a.__assign(a.__assign({},g),{folderDisplayName:h,rootDisplayName:u,folderName:n.child_dir(c),fqpath:c,activePage:p?o.RewindFlowPage.NUXPage:o.RewindFlowPage.notVisible})})(0,r);case o.DeloreanActionType.dismissNUX:return(function(e,t){return a.__assign(a.__assign({},e),{hasDismissedNUX:!0})})(e);case o.DeloreanActionType.setFolderHistoryPaginationLoading:return(function(e,t){return e.events.type===o.RewindEventState.hasContent?a.__assign(a.__assign({},e),{events:a.__assign(a.__assign({},e.events),{loadingPastPage:t.direction===o.PaginationDirection.past,loadingFuturePage:t.direction===o.PaginationDirection.future})}):e})(e,r);case o.DeloreanActionType.setEventsLoaded:case o.DeloreanActionType.setFolderHistoryPaginationLoaded:return l(e,r);case o.DeloreanActionType.setHasDismissedNUX:return(function(e,t){return a.__assign(a.__assign({},e),{hasDismissedNUX:t.hasDismissedNUX})})(e,r);case o.DeloreanActionType.changeRewindPageToNone:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.notVisible})})(e);case o.DeloreanActionType.changeRewindPageToGraphPage:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.graphPage})})(e);case o.DeloreanActionType.changeRewindPageToNUX:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.NUXPage})})(e);case o.DeloreanActionType.changeRewindPageToRewindStarted:return(function(e,t){var n;return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.startedPage,pageData:a.__assign(a.__assign({},e.pageData),(n={},n[o.RewindFlowPage.startedPage]={page:o.RewindFlowPage.startedPage,selectedEvent:t.event,rewindId:t.rewindId,rewindState:o.RewindState.InProgress},n))})})(e,r);case o.DeloreanActionType.changeRewindPageToNUXOrDayResolution:return(function(e,t){return e.hasDismissedNUX?a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.graphPage}):a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.NUXPage})})(e);case o.DeloreanActionType.changeRewindPageToConfirmationPage:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.confirmationPage,pageData:a.__assign(a.__assign({},e.pageData),{confirmationPage:{page:o.RewindFlowPage.confirmationPage,eventAboveDivider:t.eventAboveDivider}})})})(e,r);case o.DeloreanActionType.changeRewindPageFromConfirmationPageToGraphPage:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.graphPage})})(e);case o.DeloreanActionType.changeRewindPageToUpsell:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.upsellPage})})(e);case o.DeloreanActionType.loadEventCounts:return(function(e,t){for(var n=e.pageData.graphPage.contents,r="loaded"===n.type?n.data:[],s=t.eventCounts,d=a.__spreadArrays(r,s),l={},p=0,c=d;p<c.length;p++){var u=c[p];l[u.dateTsInMs]=u}var h=Object.keys(l).map((function(e){return l[Number(e)]})).sort((function(e,t){return e.dateTsInMs-t.dateTsInMs})),g="loaded"===n.type?n.selectedDateTsInMs:void 0,f="loaded"===n.type?n.selectedDateString:void 0;return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.graphPage,pageData:a.__assign(a.__assign({},e.pageData),{graphPage:{page:o.RewindFlowPage.graphPage,graphStartOffset:e.pageData.graphPage.graphStartOffset,graphEndOffset:e.pageData.graphPage.graphEndOffset,contents:{type:"loaded",data:h,hasDataThisWeek:i.checkHasDataThisWeek(h,e.pageData.graphPage.graphStartOffset,e.pageData.graphPage.graphEndOffset),selectedDateTsInMs:g,selectedDateString:f,loadingNextWeek:!1,loadingPreviousWeek:!1,namespaceCount:t.namespaceCount,changedNamespaceCount:t.changedNamespaceCount}}})})})(e,r);case o.DeloreanActionType.setRewindEventCountsError:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.graphPage,pageData:a.__assign(a.__assign({},e.pageData),{graphPage:{page:o.RewindFlowPage.graphPage,graphStartOffset:e.pageData.graphPage.graphStartOffset,graphEndOffset:e.pageData.graphPage.graphEndOffset,contents:{type:"error",errorString:t.errorString}}})})})(e,r);case o.DeloreanActionType.setRewindPanelSelectedDate:return(function(e,t){return e.activePage!==o.RewindFlowPage.graphPage||"loaded"!==e.pageData.graphPage.contents.type?e:a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.graphPage,pageData:a.__assign(a.__assign({},e.pageData),{graphPage:{page:o.RewindFlowPage.graphPage,graphStartOffset:e.pageData.graphPage.graphStartOffset,graphEndOffset:e.pageData.graphPage.graphEndOffset,contents:a.__assign(a.__assign({},e.pageData.graphPage.contents),{selectedDateTsInMs:t.selectedDateTsInMs,selectedDateString:t.selectedDateString})}})})})(e,r);case o.DeloreanActionType.changeRewindPageToActivityListPage:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.activityListPage,pageData:a.__assign(a.__assign({},e.pageData),{activityListPage:{page:o.RewindFlowPage.activityListPage,selectedDateTsInMs:t.selectedDateTsInMs,selectedDateString:t.selectedDateString}})})})(e,r);case o.DeloreanActionType.clearEventList:return(function(e,t){return a.__assign(a.__assign({},e),{events:{type:o.RewindEventState.loadingEntirePanel}})})(e);case o.DeloreanActionType.goBackFromActivityListPage:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.graphPage})})(e);case o.DeloreanActionType.goBackFromConfirmationPage:return(function(e,t){return a.__assign(a.__assign({},e),{activePage:o.RewindFlowPage.activityListPage})})(e);case o.DeloreanActionType.setGraphRangeBack:case o.DeloreanActionType.setGraphRangeForward:return p(e,r);case o.DeloreanActionType.setRewindComplete:return(function(e,t){var n;return a.__assign(a.__assign({},e),{pageData:a.__assign(a.__assign({},e.pageData),(n={},n[o.RewindFlowPage.startedPage]=a.__assign(a.__assign({},e.pageData.startedPage),{rewindState:o.RewindState.Done}),n))})})(e);case o.DeloreanActionType.setRewindInProgress:return(function(e,t){var n;return a.__assign(a.__assign({},e),{pageData:a.__assign(a.__assign({},e.pageData),(n={},n[o.RewindFlowPage.startedPage]=a.__assign(a.__assign({},e.pageData.startedPage),{rewindState:o.RewindState.InProgress}),n))})})(e);case o.DeloreanActionType.setLoadingGraphWeek:return(function(e,t){var n;return"loaded"!==e.pageData.graphPage.contents.type?e:a.__assign(a.__assign({},e),{pageData:a.__assign(a.__assign({},e.pageData),(n={},n[o.RewindFlowPage.graphPage]=a.__assign(a.__assign({},e.pageData.graphPage),{contents:a.__assign(a.__assign({},e.pageData.graphPage.contents),{loadingNextWeek:"forward"===t.graphPositionChange,loadingPreviousWeek:"backward"===t.graphPositionChange})}),n))})})(e,r);case o.DeloreanActionType.setGraphLoadFinished:return(function(e,t){var n;return"loaded"!==e.pageData.graphPage.contents.type?e:a.__assign(a.__assign({},e),{pageData:a.__assign(a.__assign({},e.pageData),(n={},n[o.RewindFlowPage.graphPage]=a.__assign(a.__assign({},e.pageData.graphPage),{contents:a.__assign(a.__assign({},e.pageData.graphPage.contents),{loadingNextWeek:!1,loadingPreviousWeek:!1})}),n))})})(e);default:return s.assertNever(r),e}}})),define("modules/clean/react/delorean/data/selectors",["require","exports","modules/clean/redux/namespaces","modules/clean/redux/selectors"],(function(e,t,a,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDeloreanState=function(e){return n.getStateAtNamespace(e,a.DELOREAN_NAMESPACE_KEY)},t.getHasDismissedNUX=function(e){return t.getDeloreanState(e).hasDismissedNUX},t.getEvents=function(e){return t.getDeloreanState(e).events},t.getFolderDisplayName=function(e){return t.getDeloreanState(e).folderDisplayName},t.getFQPath=function(e){return t.getDeloreanState(e).fqpath},t.getActivePage=function(e){return t.getDeloreanState(e).activePage},t.getAllPageData=function(e){return t.getDeloreanState(e).pageData}})),define("modules/clean/react/delorean/data/store",["require","exports","tslib","external/lodash","modules/clean/react/delorean/data/reducers","modules/clean/redux/store","modules/clean/redux/namespaces"],(function(e,t,a,n,r,s,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importStar(n),t.getDeloreanStore=n.once((function(){var e;return s.getStoreAndRegisterReducers(((e={})[o.DELOREAN_NAMESPACE_KEY]=r.reducer,e))}))})),define("modules/clean/react/delorean/constants",["require","exports","modules/clean/react/browse/constants"],(function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BUBBLE_DISTANCE=10,t.API_TIMESTAMP_NOW=0,t.SKELETON={CARD_HEIGHT:91,DEFAULT_HEIGHT:500},t.FOLDER_HISTORY_SKELETON_DEFAULT_HEIGHT=500,t.FolderHistoryEventHeaderHeight=32,t.GRAPH_WIDTH=315,t.GRAPH_HEIGHT=192,t.DEFAULT_GRAPH_LINE_WIDTH=2,t.GRAPH_BOTTOM_PADDING=20,t.DATE_LABEL_WIDTH=80,t.REWIND_GRAPH_DAY_STEP=7,t.API_VERSION=2,t.ONE_DAY_MS=864e5,t.TEMPORARY_UVH_LENGTH=180,t.LOADING_PAGE_POLLING_LENGTH_MS=5e3,t.NUM_REWIND_STEPS=3,t.FOLDER_HISTORY_QUERY_PARAM=a.BrowseQueryArg.folder_history,t.REWIND_QUERY_PARAM=a.BrowseQueryArg.rewind})),define("modules/clean/react/delorean/delorean",["require","exports","tslib","react","classnames","modules/clean/history","react-redux","modules/clean/react/delorean/data/types","modules/clean/react/delorean/data/selectors","modules/clean/react/css","modules/clean/react/delorean/components/rewind_title","modules/clean/react/delorean/data/actions","modules/clean/react/delorean/components/folder_history/folder_history","modules/clean/react/delorean/data/store","modules/clean/analytics","modules/clean/react/delorean/rewinds_upsell_util","modules/clean/react/delorean/util","modules/clean/react/delorean/components/rewind","modules/clean/react/delorean/components/rewind_started","modules/clean/react/delorean/constants","modules/clean/react/delorean/logging","modules/clean/react/delorean/logging","modules/clean/react/delorean/components/rewind_upsell_page","modules/clean/react/delorean/components/panel_open_listener"],(function(e,t,a,n,r,s,o,i,d,l,p,c,u,h,g,f,v,m,_,y,w,P,D,E){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),r=a.__importDefault(r),s=a.__importDefault(s),w=a.__importStar(w);var R=(function(e){function t(t){var a=e.call(this,t)||this;return a.closeDrawer=function(e){var t=e.closedByClick,n=void 0!==t&&t,r=a.props,o=r.activePage,i=r.allPageData,d=r.user,l=a.state.restoreId;a.props.closePanel(),n&&!a.haveLoggedCloseReason&&(w.exitDrawer({reason:P.DeloreanCloseReason.click_close,activePage:o,allPageData:i,restoreId:l,user:d}),a.haveLoggedCloseReason=!0),s.default.remove_query_param(y.REWIND_QUERY_PARAM)},a.onOpenPanel=function(){var e=a.props,t=e.user,n=e.browseContext,r=e.clickBrowseButtonTimestampMs,s=e.fromDesktopClient,o=a.state.restoreId;a.initialize(),r&&(a.props.expFolderHistoryRollbacks?w.loadNUX({browseContext:n,user:t,restoreId:o,clickBrowseButtonTimestampMs:r,fromDesktopClient:s}):f.shouldShowRewindsUpsell(t)&&w.loadUpsell({browseContext:n,user:t,restoreId:o,clickBrowseButtonTimestampMs:r,fromDesktopClient:s}))},a.onClosePanel=function(){var e=a.props,t=e.activePage,n=e.allPageData,r=e.user,o=a.state.restoreId;a.haveLoggedCloseReason||(w.exitDrawer({reason:s.default.get_url().startsWith("/home")?P.DeloreanCloseReason.browse_folder:P.DeloreanCloseReason.page_exit,activePage:t,allPageData:n,restoreId:o,user:r}),a.haveLoggedCloseReason=!0),a.setState({restoreId:g.RestorationStepsLogger.generate_restore_id(r.id)})},a.initialize=function(){var e=a.props,t=e.user,n=e.expFolderHistoryRollbacks;a.haveLoggedCloseReason=!1,a.props.dispatch(c.initializeDeloreanAction({browseContext:a.props.browseContext,user:a.props.user,openToRewind:n})),w.openActivityList({user:t,restoreId:a.state.restoreId}),a.props.dispatch(c.fetchEventsAction({user:a.props.user,fqpath:a.props.browseContext.currentFQPath,direction:i.PaginationDirection.past,timestampInSeconds:0,onlyRewindableEvents:!1})),f.shouldShowRewindsUpsell(t)&&!a.props.expFolderHistoryRollbacks&&a.props.dispatch({type:i.DeloreanActionType.changeRewindPageToUpsell})},a.onClickOnEvent=function(){var e=a.props.user,t=a.state.restoreId;w.clickOnActivityList({user:e,restoreId:t})},a.showMoreFuture=function(e){a.props.dispatch(c.showMoreAction({user:a.props.user,fqpath:a.props.browseContext.currentFQPath,futureCursor:e,direction:i.PaginationDirection.future}))},a.showMorePast=function(e){a.props.dispatch(c.showMoreAction({user:a.props.user,fqpath:a.props.browseContext.currentFQPath,pastCursor:e,direction:i.PaginationDirection.past}))},a.updateActiveTabId=function(e){"View"===e?a.props.dispatch({type:i.DeloreanActionType.changeRewindPageToNone}):a.props.dispatch({type:i.DeloreanActionType.changeRewindPageToNUXOrDayResolution})},a.state={restoreId:g.RestorationStepsLogger.generate_restore_id(t.user.id)},a.haveLoggedCloseReason=!0,a}return a.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;window.addEventListener("beforeunload",(function(t){var a=e.props,n=a.activePage,r=a.allPageData,s=a.user,o=e.state.restoreId;e.props.isVisible&&!e.haveLoggedCloseReason&&(w.exitDrawer({reason:P.DeloreanCloseReason.page_exit,activePage:n,allPageData:r,restoreId:o,user:s}),e.haveLoggedCloseReason=!0)}))},t.prototype.renderContent=function(){return this.props.activePage===i.RewindFlowPage.notVisible||!f.shouldShowRewindsUpsell(this.props.user)&&!this.props.expFolderHistoryRollbacks?n.default.createElement(u.FolderHistory,{dispatch:this.props.dispatch,onClickEvent:this.onClickOnEvent,events:this.props.events,isForARewind:!1,onShowMoreFuture:this.showMoreFuture,onShowMorePast:this.showMorePast,selectedDateTsInMs:void 0}):this.props.activePage===i.RewindFlowPage.graphPage||this.props.activePage===i.RewindFlowPage.NUXPage||this.props.activePage===i.RewindFlowPage.activityListPage||this.props.activePage===i.RewindFlowPage.confirmationPage?n.default.createElement(m.Rewind,{events:this.props.events,fqpath:this.props.fqpath,folderName:this.props.browseContext.getNameOfTargetFolder(),user:this.props.user,dispatch:this.props.dispatch,data:this.props.allPageData[this.props.activePage],graphPage:this.props.allPageData.graphPage,browseContext:this.props.browseContext,restorationsLoggingId:this.state.restoreId,closePanel:this.closeDrawer,userVersionHistoryLength:this.props.userVersionHistoryLength}):this.props.activePage===i.RewindFlowPage.startedPage?n.default.createElement(_.RewindStarted,{page:this.props.allPageData.startedPage,folderName:this.props.browseContext.getNameOfTargetFolder(),user:this.props.user,dispatch:this.props.dispatch,rewindState:this.props.allPageData.startedPage.rewindState,restoreId:this.state.restoreId,closePanel:this.closeDrawer}):this.props.activePage===i.RewindFlowPage.upsellPage?n.default.createElement(D.RewindUpsellPage,{user:this.props.user,restoreId:this.state.restoreId}):v.assertNever(this.props.activePage)},t.prototype.render=function(){var e=r.default({delorean:!0,"delorean--visible":this.props.isVisible,"delorean--hidden":!this.props.isVisible});return n.default.createElement("div",{"aria-hidden":this.props.isVisible?"false":"true",className:e},n.default.createElement(p.RewindTitle,{folderDisplayName:this.props.folderDisplayName,expFolderHistoryRollbacks:this.props.expFolderHistoryRollbacks,closePanel:this.closeDrawer,context:this.props.browseContext}),this.renderContent(),n.default.createElement(E.PanelOpenListener,{onOpenPanel:this.onOpenPanel,onClosePanel:this.onClosePanel,isVisible:this.props.isVisible,fqpath:this.props.fqpath,browseContext:this.props.browseContext}))},t})(n.default.Component);t.DeloreanInnerUnconnected=R;var b=o.connect((function(e){return{hasDismissedNUX:d.getHasDismissedNUX(e),events:d.getEvents(e),folderDisplayName:d.getFolderDisplayName(e),activePage:d.getActivePage(e),allPageData:d.getAllPageData(e),fqpath:d.getFQPath(e)}}))(R);t.RewindPanelInnerWithCss=l.requireCssWithComponent(b,["/static/css/delorean/delorean-vflAjISY1.css"]);var T=h.getDeloreanStore(),C=(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(r,e),r.prototype.render=function(){return n.default.createElement(o.Provider,{store:T},n.default.createElement(t.RewindPanelInnerWithCss,{fromDesktopClient:this.props.fromDesktopClient,userVersionHistoryLength:this.props.userVersionHistoryLength,user:this.props.user,closePanel:this.props.close,browseContext:this.props.browseContext,isVisible:this.props.isVisible,expFolderHistoryRollbacks:this.props.expFolderHistoryRollbacks,clickBrowseButtonTimestampMs:this.props.clickBrowseButtonTimestampMs}))},r})(n.default.Component);t.RewindPanel=C})),define("modules/clean/react/delorean/folder_history_panel",["require","exports","tslib","react","classnames","modules/clean/history","react-redux","modules/clean/react/delorean/data/store","modules/clean/react/css","modules/clean/react/delorean/data/selectors","modules/clean/react/delorean/components/panel_open_listener","modules/clean/react/delorean/constants","modules/clean/react/delorean/components/rewind_activity_list_page","modules/clean/analytics","modules/clean/react/delorean/components/rewind_title","modules/clean/react/delorean/data/actions"],(function(e,t,a,n,r,s,o,i,d,l,p,c,u,h,g,f){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=a.__importDefault(n),r=a.__importDefault(r),s=a.__importDefault(s);var v=(function(e){function t(t){var a=e.call(this,t)||this;return a.onClosePanel=function(){s.default.remove_query_param(c.FOLDER_HISTORY_QUERY_PARAM),a.setState({isOpen:!1})},a.onClickClose=function(e){a.props.closePanel()},a.onClickOnEvent=function(){},a.onOpenPanel=function(){a.setState({isOpen:!0}),a.props.dispatch(f.initializeDeloreanAction({browseContext:a.props.browseContext,user:a.props.user,openToRewind:!1}))},a.state={restoreId:h.RestorationStepsLogger.generate_restore_id(a.props.user.id),selectedDateTsInMs:(new Date).getTime(),isOpen:!1},a}return a.__extends(t,e),t.prototype.render=function(){var e=r.default({delorean:!0,"delorean--visible":this.props.isVisible,"delorean--hidden":!this.props.isVisible});return n.default.createElement("div",{"aria-hidden":this.props.isVisible?"false":"true",className:e},n.default.createElement(g.FolderHistoryTitle,{clickClosePanel:this.onClickClose}),this.state.isOpen&&n.default.createElement(u.RewindActivityListPage,{dispatch:this.props.dispatch,user:this.props.user,fqpath:this.props.fqpath,browseContext:this.props.browseContext,events:this.props.events,selectedDateTsInMs:(new Date).getTime(),restoreId:this.state.restoreId,isForRewindFlow:!1}),n.default.createElement(p.PanelOpenListener,{onOpenPanel:this.onOpenPanel,onClosePanel:this.onClosePanel,isVisible:this.props.isVisible,fqpath:this.props.fqpath,browseContext:this.props.browseContext}))},t})(n.default.Component);t.FolderHistoryPanelInnerUnconnected=v;var m=i.getDeloreanStore(),_=o.connect((function(e){return{events:l.getEvents(e),folderDisplayName:l.getFolderDisplayName(e),fqpath:l.getFQPath(e)}}))(v);t.FolderHistoryPanelWithCSS=d.requireCssWithComponent(_,["/static/css/delorean/delorean-vflAjISY1.css"]);var y=(function(e){function r(){return null!==e&&e.apply(this,arguments)||this}return a.__extends(r,e),r.prototype.render=function(){return n.default.createElement(o.Provider,{store:m},n.default.createElement(t.FolderHistoryPanelWithCSS,{userVersionHistoryLength:this.props.userVersionHistoryLength,user:this.props.user,closePanel:this.props.close,browseContext:this.props.browseContext,isVisible:this.props.isVisible,clickFolderHistoryButtonInBrowseTimestampMs:this.props.clickFolderHistoryButtonInBrowseTimestampMs}))},r})(n.default.Component);t.FolderHistoryPanel=y})),define("modules/clean/react/delorean/util",["require","exports","tslib","modules/core/i18n","modules/clean/filepath"],(function(e,t,a,n,r){"use strict";function s(e){return e}function o(e,t){return e[".tag"]===t}function i(e,t){return e[".tag"]===t}Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importStar(r),t.assertNever=s,t.isMetadataType=o,t.isOpType=i,t.getNameOfOpType=function(e){return i(e,"add")?"added":i(e,"delete")?"deleted":i(e,"edit")?"edited":i(e,"lost_access")?"lost access":i(e,"mount")?"mounted":i(e,"move")?"moved":i(e,"move_in")?"moved in":i(e,"move_out")?"moved out":i(e,"rename")?"renamed":i(e,"restore")?"restore":i(e,"restore_version")?"restore_version":i(e,"rollback")?"rollback":i(e,"share")?"shared":i(e,"unmount")?"unmounted":i(e,"unshare")?"unshared":i(e,"other")||i(e,"unknown")?"error":e},t.getLocationOfMetadata=function(e){return o(e,"multi_object_metadata")||o(e,"single_object_metadata")||o(e,"edit_metadata")||o(e,"rename_metadata")||o(e,"rollback_metadata")?r.normalize(e.containing_path):o(e,"move_metadata")?r.normalize(e.to_containing_path):o(e,"move_in_metadata")?r.normalize(e.to_containing_path):o(e,"move_out_metadata")?r.normalize(e.from_containing_path):o(e,"other")?"":e},t.getRepresentativeNameOfMetadata=function(e){return o(e,"single_object_metadata")||o(e,"move_metadata")||o(e,"move_in_metadata")||o(e,"move_out_metadata")||o(e,"rollback_metadata")||o(e,"edit_metadata")?e.name:o(e,"rename_metadata")?e.to_name:o(e,"other")||o(e,"multi_object_metadata")?"":e};var d=0;function l(e){var t=new Date(e.getTime());return t.setHours(0),t.setMinutes(0),t.setSeconds(0),t.setMilliseconds(0),t}t.getUid=function(){return String(++d)},t.filterType=function(e,t){return e.filter(t)},t.findIndex=function(e,t){for(var a=0;a<e.length;a++)if(t(e[a]))return a},t.findLastIndex=function(e,t){for(var a=e.length-1;a>=0;a--)if(t(e[a]))return a},t.noop=function(){},t.formatWithShortDateName=function(e){return n.intl.formatDate(e,{weekday:"short",month:"short",day:"numeric"})},t.floorDate=l,t.roundDate=function(e){var t=new Date(e.getTime()),a=l(t),n=l(t);return n.setDate(n.getDate()+1),Math.abs(t.getTime()-a.getTime())<Math.abs(t.getTime()-n.getTime())?a.getTime():n.getTime()}}));
//# sourceMappingURL=pkg-delorean.min.js-vflR6u82C.map