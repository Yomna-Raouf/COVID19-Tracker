define(["require","exports","tslib","react","modules/core/browser","modules/clean/react/delorean/data/types","modules/clean/react/snackbar","modules/core/i18n","spectrum/icon_content","classnames","spectrum/icon_arrow","spectrum/tertiary_link","spectrum/button","modules/clean/react/delorean/data/api","modules/clean/react/delorean/components/rewind_step_header","modules/clean/react/delorean/logging","modules/clean/react/delorean/constants"],(function(e,t,a,r,n,o,i,s,l,d,c,u,p,m,f,w,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),r=a.__importDefault(r),n=a.__importStar(n),d=a.__importDefault(d),m=a.__importStar(m),w=a.__importStar(w);var h=function(e){var t=e.name,a=e.displayDate,n=e.previousVersion;return r.default.createElement("div",{className:d.default({"rewind-folder-and-date":!0,"rewind-folder-and-date--previous-version":n})},r.default.createElement("div",{className:"rewind-folder-and-date__folder"},r.default.createElement(l.IconContent,{name:"folder-small"})),r.default.createElement("div",null,r.default.createElement("div",{className:"rewind-folder-and-date__name"},t),r.default.createElement("div",{className:"rewind-folder-and-date__date"},a)))},_=(function(e){function t(t){var l=e.call(this,t)||this;return l.clickCancel=function(){var e=l.props,t=e.user,a=e.restoreId;w.clickPreviewCancel({user:t,restoreId:a}),l.props.dispatch({type:o.DeloreanActionType.changeRewindPageFromConfirmationPageToGraphPage,previousPage:l.props.page})},l.clickSendBack=function(){return a.__awaiter(l,void 0,void 0,(function(){var e,t,n,l,d,c;return a.__generator(this,(function(a){switch(a.label){case 0:e=this.props,t=e.user,n=e.restoreId,w.clickPreviewId({user:t,restoreId:n}),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,m.beginRewind({path:this.props.fqpath,targetTsMicroseconds:1e3*this.props.eventToRewindTo.timestamp,user:this.props.user,restorationsLoggingId:this.props.restoreId})];case 2:return l=a.sent(),[3,4];case 3:if(d=a.sent(),c=d&&d.error&&d.error[".tag"])if("insufficient_permissions"===c)i.Snackbar.show(r.default.createElement(i.Snackbar,{closeButtonText:s.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),title:s.intl.formatMessage({id:"MKEpc0",defaultMessage:"You do not have permissions to rewind this folder."}),variant:"fail"}));else{if("invalid_arguments"!==c&&"feature_not_allowed"!==c)throw d;i.Snackbar.show(r.default.createElement(i.Snackbar,{closeButtonText:s.intl.formatMessage({id:"u/p3Pl",defaultMessage:"Close"}),title:s.intl.formatMessage({id:"6IKSeQ",defaultMessage:"We canâ€™t rewind that. Try again, or contact support."}),variant:"fail"}))}return[2];case 4:return this.props.dispatch({type:o.DeloreanActionType.changeRewindPageToRewindStarted,event:this.props.eventToRewindTo,rewindId:l.rewind.id}),[2]}}))}))},l.onGoBack=function(){var e=l.props,t=e.user,a=e.restoreId;w.clickPreviewBack({user:t,restoreId:a}),l.props.dispatch({type:o.DeloreanActionType.goBackFromConfirmationPage})},l.goToHelp=function(){var e=l.props,t=e.user,a=e.restoreId;w.clickPreviewHelp({user:t,restoreId:a}),n.unsafe_open_tab("http://www.dropbox.com/help/security/rewind")},l.state={eventCountHigh:null},l}return a.__extends(t,e),t.prototype.componentDidMount=function(){w.loadConfirmationPage({eventToRewindTo:this.props.eventToRewindTo,eventCounts:this.props.eventCounts,graphPage:this.props.graphPage,user:this.props.user,restoreId:this.props.restoreId})},t.prototype.render=function(){return r.default.createElement("div",null,r.default.createElement(f.RewindStepHeader,{currentStep:3,maxStep:g.NUM_REWIND_STEPS,instructions:s.intl.formatMessage({id:"ZTkEWF",defaultMessage:"Start rewinding?"}),onGoBack:this.onGoBack}),r.default.createElement(h,{name:this.props.folderName,displayDate:s.intl.formatMessage({id:"VciIXA",defaultMessage:"Now"}),previousVersion:!0}),r.default.createElement("div",{className:"rewind-confirmation-change-count"},r.default.createElement("div",{className:"rewind-confirmation-change-count__arrow"},r.default.createElement("div",{className:"rewind-confirmation-change-count__arrow__vertical-line"}),r.default.createElement("div",{className:"rewind-confirmation-change-count__arrow__head"}))),r.default.createElement(h,{name:this.props.folderName,displayDate:this.props.eventToRewindTo.confirmationCardDate,previousVersion:!1}),r.default.createElement("div",{className:"rewind-confirmation-explanation"},s.intl.formatMessage({id:"88dNnY",defaultMessage:"Your files and folders will look like they did before {date} at {time}"},{date:this.props.eventToRewindTo.formattedDate,time:this.props.eventToRewindTo.timeAgo})," ",r.default.createElement("a",{href:"#",onClick:this.goToHelp},s.intl.formatMessage({id:"qLPTw+",defaultMessage:"How Rewind works"})," ",r.default.createElement(c.IconArrow,{className:"arrow rewind-confirmation-explanation__arrow-icon",name:"right"}))),r.default.createElement("div",{className:"rewind-confirmation-buttons"},r.default.createElement(p.Button,{onClick:this.clickSendBack},s.intl.formatMessage({id:"rF8YNu",defaultMessage:"Rewind"})),r.default.createElement(u.TertiaryLink,{onClick:this.clickCancel,className:"cancel"},s.intl.formatMessage({id:"d9/SE1",defaultMessage:"Cancel"}))))},t})(r.default.Component);t.RewindConfirmationPage=_}));
//# sourceMappingURL=rewind_confirmation_page.min.js-vflM2eOqJ.map