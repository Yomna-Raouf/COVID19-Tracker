define(["require","exports","tslib","react","modules/clean/ajax","modules/clean/filepath","modules/clean/react/browse/constants","modules/clean/react/browse/data/action_creators","modules/clean/react/browse/data/store","modules/clean/react/browse/file_actions/file_action_helpers","modules/clean/react/extensions/data/types","modules/clean/react/extensions/split_share_button_component","modules/clean/react/file_viewer/async_controller","modules/clean/sharing/browse_exports","modules/clean/sharing/constants","modules/clean/web_user_action_events","modules/constants/python","modules/core/browser","modules/core/i18n","modules/core/uri","modules/clean/react/files_view/files_view_logging"],(function(e,r,t,i,o,n,a,s,c,l,u,S,d,_,f,h,m,g,p,E,b){"use strict";function A(e,r){var t=r.user,i=r.context,a=r.firstFile,u=r.isSearchMode,S=r.useSearchSuccessBanner,d=r.expBrowseSuccessBanner,m=r.isSidebar?h.ActionSurfaceLogValue.RIGHT_SIDEBAR:h.ActionSurfaceLogValue.CENTER_PANE;if(e.skipLogging||b.logEventWithNumberOfFiles({file:a,user:t,isSearchMode:u,action:h.WebUserActionLogEvent.SHARE,action_source:e.action_source,action_surface:m,extra:e.extra}),l.showRetrievalSuccessBanner(S,u,d,h.WebUserActionLogEvent.SHARE),e.autoShareLink){var p=new E.URI({path:"/sm/create"+n.normalize(a.fq_path)});p.updateQuery("_subject_uid",t.id.toString()),p.updateQuery("redirect","0");o.WebRequest({url:p.toString(),type:"POST",success:function(e){g.redirect(e)}})}else _.asyncShowShareModal(t,a,{browseContext:i,origin:f.SHARE_ACTION_ORIGIN_TYPE.BROWSE_FILE_ACTIONS},(function(e){var r=e.path,t=e.qargs;return c.getStoreForBrowse().dispatch(s.setUrl({path:r,qargs:t}))}))}Object.defineProperty(r,"__esModule",{value:!0}),i=t.__importDefault(i),o=t.__importStar(o),n=t.__importStar(n),g=t.__importStar(g);var w=function(r){var i=r.isSidebar?h.ActionSourceValue.SHARE:h.ActionSourceValue.OVERFLOW_MENU;return function(){return t.__awaiter(void 0,void 0,void 0,(function(){var o,n,a;return t.__generator(this,(function(s){switch(s.label){case 0:return A({autoShareLink:!1,action_source:i},r),r.isSidebar?[4,new Promise((function(r,t){e(["modules/clean/react/app_actions/telemetry_client"],r,t)})).then(t.__importStar)]:[2];case 1:return o=s.sent(),n=o.createTelemetryClient,a=o.getPiiSafeExtension,n({component:"share-btn"}).session({surface:r.isSearchMode?"search":"browse",ext:a(r.firstFile.ext)}).event("click_share",{trigger_type:u.TriggerType.SidebarPrimaryButton}),[2]}}))}))}},v=function(e){return function(r){var t=e.isSidebar?h.ActionSurfaceLogValue.RIGHT_SIDEBAR:h.ActionSurfaceLogValue.CENTER_PANE;l.logUserEventOnFile({result:e.firstFile,args:e,action_type:h.WebUserActionLogEvent.SHARE,action_source:h.ActionSourceValue.SPLIT_SHARE,action_surface:t,extra:{splitshare_option:r}})}},R=function(e){return function(){var r=e.isSidebar?h.ActionSurfaceLogValue.RIGHT_SIDEBAR:h.ActionSurfaceLogValue.CENTER_PANE;l.logUserEventOnFile({result:e.firstFile,args:e,action_type:h.WebUserActionLogEvent.OPEN_SPLITSHARE,action_source:h.ActionSourceValue.SPLIT_SHARE,action_surface:r})}},V=function(e){return function(){d.asyncOpenPreview({containerId:a.BROWSE_FILE_VIEWER_ELEMENT_ID,files:[e.firstFile],indexOfPreviewFile:0,shouldFocusComment:!1,user:e.user,onFileViewerDidMount:d.hideElementsBehindFileViewer,onFileViewerUnmount:d.showElementsBehindFileViewer,fileViewAction:m.FileViewActionType.CLICK,fileViewOrigin:m.FileViewOriginType.BROWSE,fileViewTarget:m.FileViewTargetType.PRIVATE,shouldPresentInZoom:!0})}};r.getShareItem=function(e,r){var t,o=r.shareItemDisabled,n=r.firstFile,a=r.user,s=r.isSidebar,c=r.isSearchMode,l=r.isViewSmall,d=r.showSplitShare,_=r.forceSplitShareSecondary,f=r.scrollableSidebarRef,m=r.shouldUsePortalPopover;return s&&!c&&!l&&d?function(){return i.default.createElement(S.SplitShareButton,{file:n,user:a,variant:_?"secondary":"primary",triggerType:u.TriggerType.SidebarPrimaryButton,onShowShare:(r=e,function(){A({autoShareLink:!1,action_source:h.ActionSourceValue.SPLIT_SHARE,skipLogging:!0},r)}),onDropdownOpen:R(e),logShareButtonClick:v(e),onPresentInZoom:V(e),context:{surface:c?"search":"browse"},scrollableSidebarRef:f,shouldUsePortalPopover:m});var r}:l?{label:p.intl.formatMessage({id:"6wVQkn",defaultMessage:"Share link"}),performAction:(t=e,function(){A({autoShareLink:!1,action_source:t.isSidebar?h.ActionSourceValue.SHARE:h.ActionSourceValue.OVERFLOW_MENU},t)}),disabled:o,className:"action-share-link",iconName:"link",key:"share-link"}:{label:p.intl.formatMessage({id:"TFeNOo",defaultMessage:"Share"}),iconName:"link",performAction:w(e),disabled:o,className:"action-share",key:"share"}}}));
//# sourceMappingURL=share.min.js-vflFfafXo.map