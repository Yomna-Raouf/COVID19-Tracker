define(["require","exports","tslib","modules/clean/ajax","modules/clean/api_v2/user_client","modules/core/browser","modules/core/browser_detection","modules/clean/sharing/api/client","modules/constants/file_viewer","modules/clean/file_store/utils","modules/clean/viewer","modules/clean/react/paper/paper_log","modules/core/i18n","external/lodash","modules/clean/react/bubble_dropdown_v2","modules/core/notify","modules/clean/react/sign_in/utils","modules/clean/react/size_class/utils"],(function(e,t,r,n,o,i,a,s,l,d,u,c,p,f,_,m,g,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n=r.__importStar(n),i=r.__importStar(i),l=r.__importStar(l),f=r.__importStar(f);var b,P=["VARIANT_A","VARIANT_B1","VARIANT_B2","VARIANT_B3","VARIANT_B4","ON"],x=["BUTTON","DROPDOWN","ELLIPSIS"],T=["docx"],A=["jpg","jpeg","png","pdf","xls","xlsx","mp4","mov","pptx","ppt","zip","rar","mp3"];function v(e){var t=e.file,r=e.user,n=e.sharedLink;return!!t&&((k(t)&&P.includes(l.OPEN_IN_PAPER_VARIANT)||M(t)&&x.includes(l.EMBED_TO_PAPER_VARIANT))&&!u.Viewer.get_viewer().is_assume_user_session&&!a.is_mobile_or_tablet()&&!a.msie&&(!r&&!!n||!!r&&!r.is_paper_disabled))}function M(e){var t=d.getExtension(e);return!!t&&A.includes(t)}function k(e){var t=d.getExtension(e);return!!t&&(T.includes(t)&&e.bytes<20971520)}function w(e){var t=e.file,r=e.sharedLink,o=e.contUrl,i=e.successCallback,a=e.errorCallback,s=e.extension,l=e._tk,d=e.oqa,u=e.fromModal;n.WebRequest({url:"/paper/sign_request_data",data:{path:t.file_id,sharedLink:r,cont_url:o,extension:s,_tk:l,oqa:d,fromModal:u},success:i,error:a})}(function(e){e[e.Off=1]="Off",e[e.Control=2]="Control",e[e.Button=3]="Button",e[e.Dropdown=4]="Dropdown",e[e.Ellipsis=5]="Ellipsis"})(b=t.OpenInPaperButtonVariant||(t.OpenInPaperButtonVariant={})),t.fileSizeWithinExperimentLimits=function(e,t){var r=51200;return"CONTROL"===t?r=20971520:"ONE_HUNDRED_KB"===t?r=102400:"FIFTY_KB"===t&&(r=51200),e.bytes<=r},t.getOpenInPaperButtonVariant=function(e){var t=e.file,r=e.sharedLink;return v(e)?k(t)?r?b.Button:b.Dropdown:b.Ellipsis:b.Off},t.getCalloutPosition=function(e){return e===b.Dropdown||e===b.Ellipsis?_.BubbleDropdownPositions.BOTTOM_LEFT:_.BubbleDropdownPositions.BOTTOM},t.shouldShowOpenInPaper=v,t.fileSupportsEmbedToPaper=M,t.fileSupportsCopyToPaper=k,t.getCTAText=function(e){var t=p.intl.formatMessage({id:"MhNU0E",defaultMessage:"Copy to Paper"});return M(e)&&(t=p.intl.formatMessage({id:"V4x10U",defaultMessage:"Add to Paper doc"})),t},t.getCTATextDescription=function(e){return p.intl.formatMessage({id:"8pL0xd",defaultMessage:"Collect ideas and connect all kinds of files in a single doc."})},t.shouldShowCTADescription=function(e,t){return!h.isSmallerThanLarge(t)&&M(e)},t.getCalloutTitle=function(e){return M(e)?p.intl.formatMessage({id:"xy84ul",defaultMessage:"Bring it all together"}):p.intl.formatMessage({id:"mUQPVD",defaultMessage:"Bring this doc to life"})},t.getCalloutMessage=function(e){return M(e)?p.intl.formatMessage({id:"JidWf/",defaultMessage:"Add this file to a Paper doc to collect ideas and organize your thoughts."}):p.intl.formatMessage({id:"jrZxPR",defaultMessage:"Copy to Paper and make changes or ask for feedback."})},t.createPaperAccountAndRedirect=w,t.openFileInPaper=function(e){var t=e.file,r=e.user,n=e.fromModal;if(r){var o=window.open("","_blank"),a=function(){o&&o.close(),m.Notify.error(p.intl.formatMessage({id:"HBov4l",defaultMessage:"Canâ€™t copy file to Paper"}))},l=e.sharedLink?e.sharedLink:"",u=e.sharedLink?"shared_file_actions":"mounted_file_actions",f=d.getExtension(t);c.paperLog(c.PaperEventTypes.CTA_CLICK,{source:u,cta:"open_in_paper_button",extension:f});var _={file:t,sharedLink:l,contUrl:"/create-doc-from-dropbox-file",extension:f,successCallback:function(e){o?i.redirect(e,o):i.redirect(e)},errorCallback:a,_tk:"dropbox_web_copy_from_previews",oqa:f,fromModal:n};if(k(t))w(_);else if(_._tk="dropbox_web_embed_from_previews",!l&&r){var h=new s.FileShareApiClient({userId:r.id});h.sharedLinkInfo({fileIdOrPath:t.file_id}).then((function(e){var r=e[0];r?(_.sharedLink=r.url,_.contUrl="/dropbox-file-embed",w(_)):h.createSharedLink({fileIdOrPath:t.file_id}).then((function(e){_.sharedLink=e.url,_.contUrl="/dropbox-file-embed",w(_)})).catch((function(e){a&&a()}))})).catch((function(e){a&&a()}))}else _.contUrl="/dropbox-file-embed",w(_)}else i.redirect(g.getSignInAndContinueUrl())};var C=f.once((function(){return new o.UserApiV2Client}));t.getPaperExperimentsPostTTI=function(e){return r.__awaiter(this,void 0,Promise,(function(){return r.__generator(this,(function(t){return[2,C().ns("paper_post_tti").rpc("paper_experiments",{},{subjectUserId:e.id}).then((function(e){return e.experiments}))]}))}))}}));
//# sourceMappingURL=utils.min.js-vflxV78JV.map